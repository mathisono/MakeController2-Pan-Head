<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <title>Make Controller Kit - Firmware API: xbee.c Source File</title>
  <link href="mt_doxygen.css" rel="stylesheet" type="text/css" />
  <link href="../resources/mt_doxytabs.css" rel="stylesheet" type="text/css" />
</head>

<body>
  <div id="header">
    <a href="http://www.makingthings.com">
      <img src="../resources/logo.png" alt="MakingThings" border="0"/>
    </a>
    <form id='searchbox' method="get" action="http://www.google.com/search">
      <div align="right">
        <input type="text"   name="q" size="25" maxlength="255" value="" />
        <input type="submit" value="Search" />
        <input type="hidden" name="sitesearch" value="makingthings.com/ref/firmware/html" />
      </div>
    </form>
  </div>

<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>xbee.c</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment"> Copyright 2006-2008 MakingThings</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment"> Licensed under the Apache License, </span>
<a name="l00006"></a>00006 <span class="comment"> Version 2.0 (the "License"); you may not use this file except in compliance </span>
<a name="l00007"></a>00007 <span class="comment"> with the License. You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment"> http://www.apache.org/licenses/LICENSE-2.0 </span>
<a name="l00010"></a>00010 <span class="comment"> </span>
<a name="l00011"></a>00011 <span class="comment"> Unless required by applicable law or agreed to in writing, software distributed</span>
<a name="l00012"></a>00012 <span class="comment"> under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR</span>
<a name="l00013"></a>00013 <span class="comment"> CONDITIONS OF ANY KIND, either express or implied. See the License for</span>
<a name="l00014"></a>00014 <span class="comment"> the specific language governing permissions and limitations under the License.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">*********************************************************************************/</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "config.h"</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include "stdlib.h"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "string.h"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="xbee_8h.html" title="XBee defines.">xbee.h</a>"</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="keyword">static</span> <span class="keywordtype">bool</span> XBee_GetIOValues( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* packet, <span class="keywordtype">int</span> *inputs );
<a name="l00025"></a>00025 <span class="keywordtype">void</span> XBeeTask( <span class="keywordtype">void</span>* p );
<a name="l00026"></a>00026 <span class="preprocessor">#define XBEEPACKET_Q_SIZE 5</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#define XBEE_OSC_RX_TIMEOUT 500</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00029"></a>00029 <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00030"></a>00030 {
<a name="l00031"></a>00031   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* currentPkt;
<a name="l00032"></a>00032   <span class="keywordtype">int</span> packetIndex;
<a name="l00033"></a>00033 <span class="preprocessor">  #ifdef OSC</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>  <span class="keywordtype">bool</span> autosend;
<a name="l00035"></a>00035 <span class="preprocessor">  #endif</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>  <span class="keywordtype">bool</span> waitingForConfirm;
<a name="l00037"></a>00037 } XBeeSubsystem;
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 XBeeSubsystem* XBee;
<a name="l00040"></a>00040 <span class="comment"></span>
<a name="l00041"></a>00041 <span class="comment">/** \defgroup XBee XBee</span>
<a name="l00042"></a>00042 <span class="comment">  Communicate with XBee (Zigbee) wireless modules via the Make Controller's serial port.</span>
<a name="l00043"></a>00043 <span class="comment">  </span>
<a name="l00044"></a>00044 <span class="comment">  XBee modules from \b MaxStream are small, cheap ($19 each), wireless \b RF (radio frequency) modules that</span>
<a name="l00045"></a>00045 <span class="comment">  can easily be used with the Make Controller Kit to create projects that require wireless communication.  Check</span>
<a name="l00046"></a>00046 <span class="comment">  http://www.maxstream.net/products/xbee/xbee-oem-rf-module-zigbee.php for more info.</span>
<a name="l00047"></a>00047 <span class="comment">  </span>
<a name="l00048"></a>00048 <span class="comment">  \section Overview</span>
<a name="l00049"></a>00049 <span class="comment">  XBee modules are &lt;b&gt;ZigBee/IEEE 802.15.4&lt;/b&gt; compliant and can operate in several modes:</span>
<a name="l00050"></a>00050 <span class="comment">  - Transparent serial port.  Messages in one side magically end up at the other endpoint.  Great for enabling wireless</span>
<a name="l00051"></a>00051 <span class="comment">  communication between 2 Make Controllers.</span>
<a name="l00052"></a>00052 <span class="comment">  - AT command mode.  Send traditional AT commands to configure the module itself (as opposed to having</span>
<a name="l00053"></a>00053 <span class="comment">  the data go straight through via serial mode.</span>
<a name="l00054"></a>00054 <span class="comment">  - Packet (API) mode.  Lower level communication that doesn't have to wait for the module to be in</span>
<a name="l00055"></a>00055 <span class="comment">  AT command mode.  Check the \ref XBeePacketTypes for a description of how these packets are laid out.  </span>
<a name="l00056"></a>00056 <span class="comment">  Be sure to call XBeeConfig_SetPacketApiMode before trying to do anything in this mode.</span>
<a name="l00057"></a>00057 <span class="comment"></span>
<a name="l00058"></a>00058 <span class="comment">  The general idea is that you have one XBee module connected directly to your Make Controller Kit, and then</span>
<a name="l00059"></a>00059 <span class="comment">  any number of other XBee modules that can communicate with it in order to get information to and from the</span>
<a name="l00060"></a>00060 <span class="comment">  Make Controller.  Or, several Make Controllers can each have an XBee module connected in order to</span>
<a name="l00061"></a>00061 <span class="comment">  communicate wirelessly among themselves.</span>
<a name="l00062"></a>00062 <span class="comment"></span>
<a name="l00063"></a>00063 <span class="comment">  XBee modules also have some digital and analog I/O right on them, which means you can directly connect</span>
<a name="l00064"></a>00064 <span class="comment">  sensors to the XBee modules which will both read the values and send them wirelessly.  Check the XBee doc</span>
<a name="l00065"></a>00065 <span class="comment">  for the appropriate commands to send in order to set this up.</span>
<a name="l00066"></a>00066 <span class="comment"></span>
<a name="l00067"></a>00067 <span class="comment">  \section API</span>
<a name="l00068"></a>00068 <span class="comment">  The Make Controller API for working with the XBee modules makes use of the XBee Packet API.  If you simply want to make use</span>
<a name="l00069"></a>00069 <span class="comment">  of the transparent serial port functionality, you can use the following functions:</span>
<a name="l00070"></a>00070 <span class="comment">    XBee_SetActive( )</span>
<a name="l00071"></a>00071 <span class="comment">    XBee_Write(  );</span>
<a name="l00072"></a>00072 <span class="comment">    XBee_Read( );</span>
<a name="l00073"></a>00073 <span class="comment">    XBee_GetReadable( );</span>
<a name="l00074"></a>00074 <span class="comment"></span>
<a name="l00075"></a>00075 <span class="comment">  Or if you want to handle setup etc. yourself, you don't need to deal with these - just hook up the module to your </span>
<a name="l00076"></a>00076 <span class="comment">  Make Controller and start reading and writing over the serial port.</span>
<a name="l00077"></a>00077 <span class="comment"></span>
<a name="l00078"></a>00078 <span class="comment">  Bytes sent in this way are broadcast to all XBee modules on the same chanel and with the same PAN ID.  All similarly</span>
<a name="l00079"></a>00079 <span class="comment">  configured modules will receive all bytes sent.  However, because these bytes are broadcast, there is no message</span>
<a name="l00080"></a>00080 <span class="comment">  reliability, so there's no guarantee that the messages will actually get there.</span>
<a name="l00081"></a>00081 <span class="comment"></span>
<a name="l00082"></a>00082 <span class="comment">  The XBee Packet API allows for much more flexible and powerful communication with the modules.  With the Packet API</span>
<a name="l00083"></a>00083 <span class="comment">  you can send messages to a specific module, detect where messages came from, check signal strength, and most importantly</span>
<a name="l00084"></a>00084 <span class="comment">  packets are sent with a send / acknowledges / retry scheme which greatly increases message reliability.</span>
<a name="l00085"></a>00085 <span class="comment">  </span>
<a name="l00086"></a>00086 <span class="comment">  Packet API uses commands to configure the XBee module itself, and then a handful of Zigbee specified packet types can be sent and received.  </span>
<a name="l00087"></a>00087 <span class="comment">  See \ref XBeePacketTypes for details on these packet types.  </span>
<a name="l00088"></a>00088 <span class="comment">  </span>
<a name="l00089"></a>00089 <span class="comment">  The \b XBeeConfig_ functions are convenient wrappers around some of the most common AT commands you might want to send.  For</span>
<a name="l00090"></a>00090 <span class="comment">  any of the other AT commands, check the XBee documentation and create them using XBee_CreateATCommandPacket( ).  These will always </span>
<a name="l00091"></a>00091 <span class="comment">  be sent to the XBee module attached to the Make Controller.  The \b XBee_ functions deal with sending and receiving </span>
<a name="l00092"></a>00092 <span class="comment">  messages to other XBee modules not connected to the Make Controller.</span>
<a name="l00093"></a>00093 <span class="comment"></span>
<a name="l00094"></a>00094 <span class="comment">  \ingroup Libraries</span>
<a name="l00095"></a>00095 <span class="comment">  @{</span>
<a name="l00096"></a>00096 <span class="comment">*/</span>
<a name="l00097"></a>00097 <span class="comment"></span>
<a name="l00098"></a>00098 <span class="comment">/** </span>
<a name="l00099"></a>00099 <span class="comment">  Controls the active state of the \b XBee subsystem</span>
<a name="l00100"></a>00100 <span class="comment">  @param state Whether this subsystem is active or not</span>
<a name="l00101"></a>00101 <span class="comment">  @return Zero on success.</span>
<a name="l00102"></a>00102 <span class="comment">*/</span>
<a name="l00103"></a><a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8">00103</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( <span class="keywordtype">int</span> state )
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105   <span class="keywordflow">if</span>( state ) 
<a name="l00106"></a>00106   { 
<a name="l00107"></a>00107     <span class="keywordflow">if</span>( XBee == NULL )
<a name="l00108"></a>00108     {
<a name="l00109"></a>00109       <span class="keywordflow">if</span>( <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a> != <a class="code" href="group__serial.html#g1b4e8029502b5426460f0bab5bb2ee9e" title="Set the active state of a serial port.">Serial_SetActive</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, 1 ) )
<a name="l00110"></a>00110         <span class="keywordflow">return</span> <a class="code" href="group___error.html#g11e238ec8f200a9a39f8f9ad077c7229" title="Couldn&amp;#39;t complete operation because the subsystem is inactive.">CONTROLLER_ERROR_SUBSYSTEM_INACTIVE</a>;
<a name="l00111"></a>00111       
<a name="l00112"></a>00112       <span class="comment">// Configure the serial port</span>
<a name="l00113"></a>00113       <a class="code" href="group__serial.html#g1f6aba7eb096e58461c2b872d497ba6f" title="Sets the serial baud rate.">Serial_SetBaud</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, 9600 );
<a name="l00114"></a>00114       <a class="code" href="group__serial.html#gfc77f3de711cb225e9dc9ec728b951bc" title="Sets the number of bits per character.">Serial_SetBits</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, 8 );
<a name="l00115"></a>00115       <a class="code" href="group__serial.html#g556ef982a4ecc2cfd67b538ca32b58fd" title="Sets the parity.">Serial_SetParity</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, 0 );
<a name="l00116"></a>00116       <a class="code" href="group__serial.html#g77ecf57b8c85a2cd191ddc4a5bc9e5c2" title="Sets the stop bits per character.">Serial_SetStopBits</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, 1 );
<a name="l00117"></a>00117 
<a name="l00118"></a>00118       XBee = <a class="code" href="group___utils.html#g95923aa748602fa0330903fca05ca892" title="Same as Malloc, but keeps trying until it succeeds.">MallocWait</a>( <span class="keyword">sizeof</span>( XBeeSubsystem ), 100 );
<a name="l00119"></a>00119       XBee-&gt;packetIndex = 0;
<a name="l00120"></a>00120 <span class="preprocessor">      #ifdef OSC</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>        XBee-&gt;autosend = XBee_GetAutoSend( <span class="keyword">true</span> );
<a name="l00122"></a>00122 <span class="preprocessor">      #endif</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span>      XBee-&gt;currentPkt = <a class="code" href="group___utils.html#g95923aa748602fa0330903fca05ca892" title="Same as Malloc, but keeps trying until it succeeds.">MallocWait</a>( <span class="keyword">sizeof</span>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> ), 100 );
<a name="l00124"></a>00124       <a class="code" href="group___x_bee.html#g066e28d0aaafb23eb1171bcdb31e5c45" title="Initialize a packet before reading into it.">XBee_ResetPacket</a>( XBee-&gt;currentPkt );
<a name="l00125"></a>00125       XBee-&gt;waitingForConfirm = <span class="keyword">false</span>;
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127   }
<a name="l00128"></a>00128   <span class="keywordflow">else</span>
<a name="l00129"></a>00129   {
<a name="l00130"></a>00130     <a class="code" href="group__serial.html#g1b4e8029502b5426460f0bab5bb2ee9e" title="Set the active state of a serial port.">Serial_SetActive</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, 0 );
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="keywordflow">if</span>( XBee )
<a name="l00133"></a>00133     {
<a name="l00134"></a>00134       <a class="code" href="group___utils.html#g6b0be54448d6ce393134400f4b22fa97" title="Free memory from the heap.">Free</a>( XBee );
<a name="l00135"></a>00135       <a class="code" href="group___utils.html#g6b0be54448d6ce393134400f4b22fa97" title="Free memory from the heap.">Free</a>( XBee-&gt;currentPkt );
<a name="l00136"></a>00136       XBee = NULL;
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138   }
<a name="l00139"></a>00139   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 <span class="comment"></span>
<a name="l00142"></a>00142 <span class="comment">/** </span>
<a name="l00143"></a>00143 <span class="comment">  Read the active state of the \b XBee subsystem</span>
<a name="l00144"></a>00144 <span class="comment">  @return An integer specifying the active state - 1 (active) or 0 (inactive).</span>
<a name="l00145"></a>00145 <span class="comment">*/</span>
<a name="l00146"></a><a class="code" href="group___x_bee.html#gb9837489c49f82e3ca25f0da44c58a13">00146</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#gb9837489c49f82e3ca25f0da44c58a13" title="Read the active state of the XBee subsystem.">XBee_GetActive</a>( )
<a name="l00147"></a>00147 {
<a name="l00148"></a>00148   <span class="keywordflow">return</span> <a class="code" href="group__serial.html#g7df7858e94ad7605bbd8d071321f0c03" title="Read the active state of the Serial subsystem.">Serial_GetActive</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a> );
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="comment"></span>
<a name="l00152"></a>00152 <span class="comment">/** </span>
<a name="l00153"></a>00153 <span class="comment">  Write the specified number of bytes into the XBee unit.  It is</span>
<a name="l00154"></a>00154 <span class="comment">  assumed that the unit is in TRANSPARENT, not in PACKET API mode.  To write to the </span>
<a name="l00155"></a>00155 <span class="comment">  unit using packets first set packet mode (using XBeeConfig_SetPacketApiMode) then use</span>
<a name="l00156"></a>00156 <span class="comment">  XBee_CreateXXXPacket() followed by XBee_SendPacket().</span>
<a name="l00157"></a>00157 <span class="comment">  @param buffer The block of bytes to write</span>
<a name="l00158"></a>00158 <span class="comment">  @param count The number of bytes to write</span>
<a name="l00159"></a>00159 <span class="comment">  @param timeout The time in ms to linger waiting to succeed (0 for no wait)</span>
<a name="l00160"></a>00160 <span class="comment">  @return status</span>
<a name="l00161"></a>00161 <span class="comment">*/</span>
<a name="l00162"></a><a class="code" href="group___x_bee.html#g239199d3a191d8528320126c059e84c7">00162</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#g239199d3a191d8528320126c059e84c7" title="Write the specified number of bytes into the XBee unit.">XBee_Write</a>( uchar *buffer, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> timeout )
<a name="l00163"></a>00163 {
<a name="l00164"></a>00164   <span class="keywordflow">return</span> <a class="code" href="group__serial.html#g16cb3d898e0ece4b4ee49c72ad6b1a36" title="Write a block of data to the Serial port.">Serial_Write</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, buffer, count, timeout );
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 <span class="comment"></span>
<a name="l00167"></a>00167 <span class="comment">/** </span>
<a name="l00168"></a>00168 <span class="comment">  Read data from the Xbee unit waiting for the specified time. Use XBee_GetReadable() to </span>
<a name="l00169"></a>00169 <span class="comment">  determine how many bytes are waiting to avoid waiting.    It is</span>
<a name="l00170"></a>00170 <span class="comment">  assumed that the unit is in TRANSPARENT, not in PACKET API mode.  To write to the </span>
<a name="l00171"></a>00171 <span class="comment">  unit using packets first set packet mode (using XBeeConfig_SetPacketApiMode) then use</span>
<a name="l00172"></a>00172 <span class="comment">  XBee_CreateXXXPacket() followed by XBee_SendPacket().</span>
<a name="l00173"></a>00173 <span class="comment">  @param buffer A pointer to the buffer to read into.</span>
<a name="l00174"></a>00174 <span class="comment">  @param count An integer specifying the maximum number of bytes to read.</span>
<a name="l00175"></a>00175 <span class="comment">  @param timeout Time in milliseconds to block waiting for the specified number of bytes. 0 means don't wait.</span>
<a name="l00176"></a>00176 <span class="comment">  @return number of bytes read (&gt;=0) or error &lt;0 .</span>
<a name="l00177"></a>00177 <span class="comment">*/</span>
<a name="l00178"></a><a class="code" href="group___x_bee.html#gff28ba1ba26d6eb0c94045520b35b6fd">00178</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#gff28ba1ba26d6eb0c94045520b35b6fd" title="Read data from the Xbee unit waiting for the specified time.">XBee_Read</a>( uchar* buffer, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> timeout )
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180   <span class="keywordflow">return</span> <a class="code" href="group__serial.html#g06dc840f81d99f3877868bfd269dc6fb" title="Read data from the Serial port.">Serial_Read</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, buffer, count, timeout );
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 <span class="comment"></span>
<a name="l00183"></a>00183 <span class="comment">/** </span>
<a name="l00184"></a>00184 <span class="comment">  Returns the number of bytes in the queue waiting to be read.</span>
<a name="l00185"></a>00185 <span class="comment">  @return bytes in the receive queue.</span>
<a name="l00186"></a>00186 <span class="comment">*/</span>
<a name="l00187"></a>00187 <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#g1893372e87de84879591c054279a2b9b" title="Returns the number of bytes in the queue waiting to be read.">XBee_GetReadable</a>( <span class="keywordtype">void</span> );
<a name="l00188"></a>00188 <span class="comment"></span>
<a name="l00189"></a>00189 <span class="comment">/** </span>
<a name="l00190"></a>00190 <span class="comment">  Receive an incoming XBee packet.</span>
<a name="l00191"></a>00191 <span class="comment">  A single call to this will continue to read from the serial port as long as there are characters </span>
<a name="l00192"></a>00192 <span class="comment">  to read or until it times out.  If a packet has not been completely received, call it repeatedly</span>
<a name="l00193"></a>00193 <span class="comment">  with the same packet.</span>
<a name="l00194"></a>00194 <span class="comment"></span>
<a name="l00195"></a>00195 <span class="comment">  Clear out a packet before reading into it with a call to XBee_ResetPacket( )</span>
<a name="l00196"></a>00196 <span class="comment">  @param packet The XBeePacket to receive into.</span>
<a name="l00197"></a>00197 <span class="comment">  @param timeout The number of milliseconds to wait for a packet to arrive.  Set this to 0 to return as</span>
<a name="l00198"></a>00198 <span class="comment">  soon as there are no characters left to process.</span>
<a name="l00199"></a>00199 <span class="comment">  @return 1 if a complete packet has been received, 0 if not.</span>
<a name="l00200"></a>00200 <span class="comment">  @see XBeeConfig_SetPacketApiMode( )</span>
<a name="l00201"></a>00201 <span class="comment">  @todo Probably need some way to reset the parser if there are no bytes for a while</span>
<a name="l00202"></a>00202 <span class="comment"></span>
<a name="l00203"></a>00203 <span class="comment">  \par Example</span>
<a name="l00204"></a>00204 <span class="comment">  \code</span>
<a name="l00205"></a>00205 <span class="comment">  // we're inside a task here...</span>
<a name="l00206"></a>00206 <span class="comment">  XBeePacket myPacket;</span>
<a name="l00207"></a>00207 <span class="comment">  XBee_ResetPacket( &amp;myPacket );</span>
<a name="l00208"></a>00208 <span class="comment">  while( 1 )</span>
<a name="l00209"></a>00209 <span class="comment">  {</span>
<a name="l00210"></a>00210 <span class="comment">    if( XBee_GetPacket( &amp;myPacket, 100 ) )</span>
<a name="l00211"></a>00211 <span class="comment">    {</span>
<a name="l00212"></a>00212 <span class="comment">      // process the new packet</span>
<a name="l00213"></a>00213 <span class="comment">      XBee_ResetPacket( &amp;myPacket ); // then clear it out before reading again</span>
<a name="l00214"></a>00214 <span class="comment">    }</span>
<a name="l00215"></a>00215 <span class="comment">    Sleep( 10 );</span>
<a name="l00216"></a>00216 <span class="comment">  }</span>
<a name="l00217"></a>00217 <span class="comment">  \endcode</span>
<a name="l00218"></a>00218 <span class="comment">*/</span>
<a name="l00219"></a><a class="code" href="group___x_bee.html#gb6f350a2b5dea977c3ab6244e4984833">00219</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#gb6f350a2b5dea977c3ab6244e4984833" title="Receive an incoming XBee packet.">XBee_GetPacket</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* packet, <span class="keywordtype">int</span> timeout )
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221   <span class="keywordflow">if</span>( <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a> != <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( 1 ) )
<a name="l00222"></a>00222     <span class="keywordflow">return</span> <a class="code" href="group___error.html#g11e238ec8f200a9a39f8f9ad077c7229" title="Couldn&amp;#39;t complete operation because the subsystem is inactive.">CONTROLLER_ERROR_SUBSYSTEM_INACTIVE</a>;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   <span class="keywordtype">int</span> time = <a class="code" href="group___tasks.html#gc899bfb04919f3af158289bdcb2901de" title="Returns the number of ticks since the scheduler started.">TaskGetTickCount</a>( );
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <span class="keywordflow">do</span>
<a name="l00227"></a>00227   {
<a name="l00228"></a>00228     <a class="code" href="group__serial.html#ga66a6208ab690c81e92e6c79ac9cef35" title="Reset the error flags in the serial system.">Serial_ClearErrors</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a> );
<a name="l00229"></a>00229     <span class="keywordflow">while</span>( <a class="code" href="group__serial.html#gc9c7891624c9f4afe235f2a032af758e" title="Returns the number of bytes in the queue waiting to be read.">Serial_GetReadable</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a> ) )
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231       <span class="keywordtype">int</span> newChar = <a class="code" href="group__serial.html#ge1e68642844831927d466dee5e52fefe" title="Returns a single character from the receive queue if available.">Serial_GetChar</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a> );
<a name="l00232"></a>00232       <span class="keywordflow">if</span>( newChar == -1 )
<a name="l00233"></a>00233         <span class="keywordflow">break</span>;
<a name="l00234"></a>00234   
<a name="l00235"></a>00235       <span class="keywordflow">switch</span>( packet-&gt;<a class="code" href="struct_x_bee_packet.html#c2052c7bbb3a252501b67e6b93e1ba80" title="Used internally by XBee_GetPacket() to keep track of the parse state.">rxState</a> )
<a name="l00236"></a>00236       {
<a name="l00237"></a>00237         <span class="keywordflow">case</span> XBEE_PACKET_RX_START:
<a name="l00238"></a>00238           <span class="keywordflow">if</span>( newChar == XBEE_PACKET_STARTBYTE )
<a name="l00239"></a>00239             packet-&gt;<a class="code" href="struct_x_bee_packet.html#c2052c7bbb3a252501b67e6b93e1ba80" title="Used internally by XBee_GetPacket() to keep track of the parse state.">rxState</a> = XBEE_PACKET_RX_LENGTH_1;
<a name="l00240"></a>00240           <span class="keywordflow">break</span>;
<a name="l00241"></a>00241         <span class="keywordflow">case</span> XBEE_PACKET_RX_LENGTH_1:
<a name="l00242"></a>00242           packet-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> = newChar;
<a name="l00243"></a>00243           packet-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> &lt;&lt;= 8;
<a name="l00244"></a>00244           packet-&gt;<a class="code" href="struct_x_bee_packet.html#c2052c7bbb3a252501b67e6b93e1ba80" title="Used internally by XBee_GetPacket() to keep track of the parse state.">rxState</a> = XBEE_PACKET_RX_LENGTH_2;
<a name="l00245"></a>00245           <span class="keywordflow">break</span>;
<a name="l00246"></a>00246         <span class="keywordflow">case</span> XBEE_PACKET_RX_LENGTH_2:
<a name="l00247"></a>00247           packet-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> += newChar;
<a name="l00248"></a>00248           <span class="keywordflow">if</span>( packet-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> &gt; XBEE_MAX_PACKET_SIZE ) <span class="comment">// in case we somehow get some garbage</span>
<a name="l00249"></a>00249             packet-&gt;<a class="code" href="struct_x_bee_packet.html#c2052c7bbb3a252501b67e6b93e1ba80" title="Used internally by XBee_GetPacket() to keep track of the parse state.">rxState</a> = XBEE_PACKET_RX_START;
<a name="l00250"></a>00250           <span class="keywordflow">else</span>
<a name="l00251"></a>00251             packet-&gt;<a class="code" href="struct_x_bee_packet.html#c2052c7bbb3a252501b67e6b93e1ba80" title="Used internally by XBee_GetPacket() to keep track of the parse state.">rxState</a> = XBEE_PACKET_RX_PAYLOAD;
<a name="l00252"></a>00252           packet-&gt;<a class="code" href="struct_x_bee_packet.html#c877fa5d2bc9064f67a1e6d4730c4287" title="The checksum for this packet - mostly used internally by XBee_SendPacket() and XBee_GetPacket()...">crc</a> = 0;
<a name="l00253"></a>00253           <span class="keywordflow">break</span>;
<a name="l00254"></a>00254         <span class="keywordflow">case</span> XBEE_PACKET_RX_PAYLOAD:
<a name="l00255"></a>00255           *packet-&gt;<a class="code" href="struct_x_bee_packet.html#1a0dafc130834bfef732c011a4f5d021" title="A pointer into the packet structure itself.">dataPtr</a>++ = newChar;
<a name="l00256"></a>00256           <span class="keywordflow">if</span>( ++packet-&gt;<a class="code" href="struct_x_bee_packet.html#10bd9979f0046f4047429e5702a24ca6" title="Used internally by XBee_GetPacket() to keep track of the current length.">index</a> &gt;= packet-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> )
<a name="l00257"></a>00257             packet-&gt;<a class="code" href="struct_x_bee_packet.html#c2052c7bbb3a252501b67e6b93e1ba80" title="Used internally by XBee_GetPacket() to keep track of the parse state.">rxState</a> = XBEE_PACKET_RX_CRC;
<a name="l00258"></a>00258           packet-&gt;<a class="code" href="struct_x_bee_packet.html#c877fa5d2bc9064f67a1e6d4730c4287" title="The checksum for this packet - mostly used internally by XBee_SendPacket() and XBee_GetPacket()...">crc</a> += newChar;
<a name="l00259"></a>00259           <span class="keywordflow">break</span>;
<a name="l00260"></a>00260         <span class="keywordflow">case</span> XBEE_PACKET_RX_CRC:
<a name="l00261"></a>00261           packet-&gt;<a class="code" href="struct_x_bee_packet.html#c877fa5d2bc9064f67a1e6d4730c4287" title="The checksum for this packet - mostly used internally by XBee_SendPacket() and XBee_GetPacket()...">crc</a> += newChar;
<a name="l00262"></a>00262           packet-&gt;<a class="code" href="struct_x_bee_packet.html#c2052c7bbb3a252501b67e6b93e1ba80" title="Used internally by XBee_GetPacket() to keep track of the parse state.">rxState</a> = XBEE_PACKET_RX_START;
<a name="l00263"></a>00263           <span class="keywordflow">if</span>( packet-&gt;<a class="code" href="struct_x_bee_packet.html#c877fa5d2bc9064f67a1e6d4730c4287" title="The checksum for this packet - mostly used internally by XBee_SendPacket() and XBee_GetPacket()...">crc</a> == 0xFF )
<a name="l00264"></a>00264             <span class="keywordflow">return</span> 1;
<a name="l00265"></a>00265           <span class="keywordflow">else</span>
<a name="l00266"></a>00266           {
<a name="l00267"></a>00267             <a class="code" href="group___x_bee.html#g066e28d0aaafb23eb1171bcdb31e5c45" title="Initialize a packet before reading into it.">XBee_ResetPacket</a>( packet );
<a name="l00268"></a>00268             <span class="keywordflow">return</span> 0;
<a name="l00269"></a>00269           }
<a name="l00270"></a>00270       }
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     <span class="keywordflow">if</span> ( timeout &gt; 0 )
<a name="l00273"></a>00273       <a class="code" href="group___tasks.html#g9a64a7c0e24f257826103d1d1bbb44fa" title="Put a task to sleep for a given number of milliseconds.">Sleep</a>( 1 );
<a name="l00274"></a>00274   } <span class="keywordflow">while</span>( ( <a class="code" href="group___tasks.html#gc899bfb04919f3af158289bdcb2901de" title="Returns the number of ticks since the scheduler started.">TaskGetTickCount</a>( ) - time ) &lt; timeout );
<a name="l00275"></a>00275   <span class="keywordflow">return</span> 0;
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 <span class="comment"></span>
<a name="l00278"></a>00278 <span class="comment">/** </span>
<a name="l00279"></a>00279 <span class="comment">  Send an XBee packet.</span>
<a name="l00280"></a>00280 <span class="comment">  Use the following functions to create packets to be sent:</span>
<a name="l00281"></a>00281 <span class="comment">  - XBee_CreateTX16Packet( ) - create a data packet to be sent out wirelessly with a 16-bit address</span>
<a name="l00282"></a>00282 <span class="comment">  - XBee_CreateTX64Packet( ) - create a data packet to be sent out wirelessly with a 64-bit address</span>
<a name="l00283"></a>00283 <span class="comment">  - XBee_CreateATCommandPacket( ) - create an AT command to configure an attached XBee module</span>
<a name="l00284"></a>00284 <span class="comment">  @param packet The XBeePacket to send.</span>
<a name="l00285"></a>00285 <span class="comment">  @param datalength The length of the actual data being sent (not including headers, options, etc.)</span>
<a name="l00286"></a>00286 <span class="comment">  @return Zero on success.</span>
<a name="l00287"></a>00287 <span class="comment">  @see XBeeConfig_SetPacketApiMode( )</span>
<a name="l00288"></a>00288 <span class="comment"></span>
<a name="l00289"></a>00289 <span class="comment">  \par Example</span>
<a name="l00290"></a>00290 <span class="comment">  \code</span>
<a name="l00291"></a>00291 <span class="comment">  XBeePacket txPacket;</span>
<a name="l00292"></a>00292 <span class="comment">  uint8 data[] = "ABC"; // 3 bytes of data</span>
<a name="l00293"></a>00293 <span class="comment">  XBee_CreateTX16Packet( &amp;txPacket, 0, 0, 0, data, 3 );</span>
<a name="l00294"></a>00294 <span class="comment">  XBee_SendPacket( &amp;txPacket, 3 );</span>
<a name="l00295"></a>00295 <span class="comment">  \endcode</span>
<a name="l00296"></a>00296 <span class="comment">*/</span>
<a name="l00297"></a><a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3">00297</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* packet, <span class="keywordtype">int</span> datalength )
<a name="l00298"></a>00298 {
<a name="l00299"></a>00299   <span class="keywordflow">if</span>( <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a> != <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( 1 ) )
<a name="l00300"></a>00300     <span class="keywordflow">return</span> <a class="code" href="group___error.html#g11e238ec8f200a9a39f8f9ad077c7229" title="Couldn&amp;#39;t complete operation because the subsystem is inactive.">CONTROLLER_ERROR_SUBSYSTEM_INACTIVE</a>;
<a name="l00301"></a>00301   
<a name="l00302"></a>00302   <a class="code" href="group__serial.html#g02fdf1c9d47551dbc5a1b4055a70b941" title="Sends a character (in the range of 0 to 255) to the write queue.">Serial_SetChar</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, XBEE_PACKET_STARTBYTE );
<a name="l00303"></a>00303   <span class="keywordtype">int</span> size = datalength;
<a name="l00304"></a>00304   <span class="keywordflow">switch</span>( packet-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> )
<a name="l00305"></a>00305   {
<a name="l00306"></a>00306     <span class="keywordflow">case</span> <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d8462a2ace5ba813e594cedb623355792b8" title="An outgoing data packet with a 64-bit address.">XBEE_TX64</a>: <span class="comment">//account for apiId, frameId, 8 bytes destination, and options</span>
<a name="l00307"></a>00307       size += 11;
<a name="l00308"></a>00308       <span class="keywordflow">break</span>;
<a name="l00309"></a>00309     <span class="keywordflow">case</span> <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d8437b041bc71f64cf55502e3266ef463af" title="An outgoing data packet with a 16-bit address.">XBEE_TX16</a>: <span class="comment">//account for apiId, frameId, 2 bytes destination, and options</span>
<a name="l00310"></a>00310       size += 5; 
<a name="l00311"></a>00311       <span class="keywordflow">break</span>;
<a name="l00312"></a>00312     <span class="keywordflow">case</span> <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d842a4dbaff63642056a3122db51c043413" title="An AT command packet.">XBEE_ATCOMMAND</a>: <span class="comment">// length = API ID + Frame ID, + AT Command (+ Parameter Value)</span>
<a name="l00313"></a>00313       size = (datalength &gt; 0) ? 8 : 4; <span class="comment">// if we're writing, there are 4 bytes of data, otherwise, just the length above</span>
<a name="l00314"></a>00314       <span class="keywordflow">break</span>;
<a name="l00315"></a>00315     <span class="keywordflow">default</span>:
<a name="l00316"></a>00316       size = 0;
<a name="l00317"></a>00317       <span class="keywordflow">break</span>;
<a name="l00318"></a>00318   }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320   <a class="code" href="group__serial.html#g02fdf1c9d47551dbc5a1b4055a70b941" title="Sends a character (in the range of 0 to 255) to the write queue.">Serial_SetChar</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, (size &gt;&gt; 8) &amp; 0xFF ); <span class="comment">// send the most significant bit</span>
<a name="l00321"></a>00321   <a class="code" href="group__serial.html#g02fdf1c9d47551dbc5a1b4055a70b941" title="Sends a character (in the range of 0 to 255) to the write queue.">Serial_SetChar</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, size &amp; 0xFF ); <span class="comment">// then the LSB</span>
<a name="l00322"></a>00322   packet-&gt;<a class="code" href="struct_x_bee_packet.html#c877fa5d2bc9064f67a1e6d4730c4287" title="The checksum for this packet - mostly used internally by XBee_SendPacket() and XBee_GetPacket()...">crc</a> = 0; <span class="comment">// just in case it hasn't been initialized.</span>
<a name="l00323"></a>00323   uint8* p = (uint8*)packet;
<a name="l00324"></a>00324   <span class="keywordflow">while</span>( size-- )
<a name="l00325"></a>00325   {
<a name="l00326"></a>00326     <a class="code" href="group__serial.html#g02fdf1c9d47551dbc5a1b4055a70b941" title="Sends a character (in the range of 0 to 255) to the write queue.">Serial_SetChar</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, *p );
<a name="l00327"></a>00327     packet-&gt;<a class="code" href="struct_x_bee_packet.html#c877fa5d2bc9064f67a1e6d4730c4287" title="The checksum for this packet - mostly used internally by XBee_SendPacket() and XBee_GetPacket()...">crc</a> += *p++;
<a name="l00328"></a>00328   }
<a name="l00329"></a>00329   <span class="comment">//uint8 test = 0xFF - packet-&gt;crc;</span>
<a name="l00330"></a>00330   <a class="code" href="group__serial.html#g02fdf1c9d47551dbc5a1b4055a70b941" title="Sends a character (in the range of 0 to 255) to the write queue.">Serial_SetChar</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, 0xFF - packet-&gt;<a class="code" href="struct_x_bee_packet.html#c877fa5d2bc9064f67a1e6d4730c4287" title="The checksum for this packet - mostly used internally by XBee_SendPacket() and XBee_GetPacket()...">crc</a> );
<a name="l00331"></a>00331   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 <span class="comment"></span>
<a name="l00334"></a>00334 <span class="comment">/** </span>
<a name="l00335"></a>00335 <span class="comment">  Initialize a packet before reading into it.</span>
<a name="l00336"></a>00336 <span class="comment">  @param packet The XBeePacket to initialize.</span>
<a name="l00337"></a>00337 <span class="comment">  @see XBee_GetPacket( )</span>
<a name="l00338"></a>00338 <span class="comment">*/</span>
<a name="l00339"></a><a class="code" href="group___x_bee.html#g066e28d0aaafb23eb1171bcdb31e5c45">00339</a> <span class="keywordtype">void</span> <a class="code" href="group___x_bee.html#g066e28d0aaafb23eb1171bcdb31e5c45" title="Initialize a packet before reading into it.">XBee_ResetPacket</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* packet )
<a name="l00340"></a>00340 {
<a name="l00341"></a>00341   packet-&gt;<a class="code" href="struct_x_bee_packet.html#1a0dafc130834bfef732c011a4f5d021" title="A pointer into the packet structure itself.">dataPtr</a> = (uint8*)packet;
<a name="l00342"></a>00342   packet-&gt;<a class="code" href="struct_x_bee_packet.html#c877fa5d2bc9064f67a1e6d4730c4287" title="The checksum for this packet - mostly used internally by XBee_SendPacket() and XBee_GetPacket()...">crc</a> = 0;
<a name="l00343"></a>00343   packet-&gt;<a class="code" href="struct_x_bee_packet.html#c2052c7bbb3a252501b67e6b93e1ba80" title="Used internally by XBee_GetPacket() to keep track of the parse state.">rxState</a> = XBEE_PACKET_RX_START;
<a name="l00344"></a>00344   packet-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> = 0;
<a name="l00345"></a>00345   packet-&gt;<a class="code" href="struct_x_bee_packet.html#10bd9979f0046f4047429e5702a24ca6" title="Used internally by XBee_GetPacket() to keep track of the current length.">index</a> = 0;
<a name="l00346"></a>00346   packet-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> = 0;
<a name="l00347"></a>00347   memset( packet-&gt;<a class="code" href="struct_x_bee_packet.html#019a93094a26005af15727d97f909282">payload</a>, 0, 100 );
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 <span class="comment"></span>
<a name="l00350"></a>00350 <span class="comment">/** </span>
<a name="l00351"></a>00351 <span class="comment">  Checks to see if a packet is receiving a message</span>
<a name="l00352"></a>00352 <span class="comment">  @param packet The XBeePacket to check</span>
<a name="l00353"></a>00353 <span class="comment">  @returns true if the packet is busy, false if it's free</span>
<a name="l00354"></a>00354 <span class="comment">*/</span>
<a name="l00355"></a><a class="code" href="group___x_bee.html#g3c5a7b65b5a7c71a57e45cfab591deb4">00355</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#g3c5a7b65b5a7c71a57e45cfab591deb4" title="Checks to see if a packet is receiving a message.">XBee_IsBusyPacket</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* packet )
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357   <span class="keywordflow">return</span> ( packet-&gt;<a class="code" href="struct_x_bee_packet.html#c2052c7bbb3a252501b67e6b93e1ba80" title="Used internally by XBee_GetPacket() to keep track of the parse state.">rxState</a> != XBEE_PACKET_RX_START );
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 <span class="comment"></span>
<a name="l00360"></a>00360 <span class="comment">/** </span>
<a name="l00361"></a>00361 <span class="comment">  Set a module into packet API mode.  </span>
<a name="l00362"></a>00362 <span class="comment">  XBee modules are in transparent serial port mode by default.  This allows you to work with them</span>
<a name="l00363"></a>00363 <span class="comment">  via the packet API.</span>
<a name="l00364"></a>00364 <span class="comment"></span>
<a name="l00365"></a>00365 <span class="comment">  When setting this on, the XBee module needs to wait 1 second after sending the command sequence before it's </span>
<a name="l00366"></a>00366 <span class="comment">  ready to receive any AT commands - this function will block for that amount of time.  Once you turn it off,</span>
<a name="l00367"></a>00367 <span class="comment">  you won't get any responses to packets you send the module until you turn packet mode on again.</span>
<a name="l00368"></a>00368 <span class="comment">  @param value 1 to turn packet mode on, 0 to turn it off.</span>
<a name="l00369"></a>00369 <span class="comment">  </span>
<a name="l00370"></a>00370 <span class="comment">  \par Example</span>
<a name="l00371"></a>00371 <span class="comment">  \code</span>
<a name="l00372"></a>00372 <span class="comment">  MyTask( void * p )</span>
<a name="l00373"></a>00373 <span class="comment">  {</span>
<a name="l00374"></a>00374 <span class="comment">    XBeeConfig_SetPacketApiMode( 1 ); // initialize the module to be in API mode</span>
<a name="l00375"></a>00375 <span class="comment">    while( 1 )</span>
<a name="l00376"></a>00376 <span class="comment">    {</span>
<a name="l00377"></a>00377 <span class="comment">      // your task here.</span>
<a name="l00378"></a>00378 <span class="comment">    }</span>
<a name="l00379"></a>00379 <span class="comment">  }</span>
<a name="l00380"></a>00380 <span class="comment">  \endcode</span>
<a name="l00381"></a>00381 <span class="comment">*/</span>
<a name="l00382"></a><a class="code" href="group___x_bee.html#gb3abc9b61091749d5aa7a48e8aa35e18">00382</a> <span class="keywordtype">void</span> <a class="code" href="group___x_bee.html#gb3abc9b61091749d5aa7a48e8aa35e18" title="Set a module into packet API mode.">XBeeConfig_SetPacketApiMode</a>( <span class="keywordtype">int</span> value )
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384   <span class="keywordflow">if</span>( <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a> != <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( 1 ) )
<a name="l00385"></a>00385     <span class="keywordflow">return</span>;
<a name="l00386"></a>00386   
<a name="l00387"></a>00387   <span class="keywordflow">if</span>( value )
<a name="l00388"></a>00388   {
<a name="l00389"></a>00389     <span class="keywordtype">char</span> buf[50];
<a name="l00390"></a>00390     sprintf( buf, <span class="stringliteral">"+++"</span> ); <span class="comment">// enter command mode</span>
<a name="l00391"></a>00391     <a class="code" href="group__serial.html#g16cb3d898e0ece4b4ee49c72ad6b1a36" title="Write a block of data to the Serial port.">Serial_Write</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, (uchar*)buf, strlen(buf), 0 );
<a name="l00392"></a>00392     <a class="code" href="group___tasks.html#g9a64a7c0e24f257826103d1d1bbb44fa" title="Put a task to sleep for a given number of milliseconds.">Sleep</a>( 1025 ); <span class="comment">// have to wait one second after +++ to actually get set to receive in AT mode</span>
<a name="l00393"></a>00393     sprintf( buf, <span class="stringliteral">"ATAP1,CN\r"</span> ); <span class="comment">// turn API mode on, and leave command mode</span>
<a name="l00394"></a>00394     <a class="code" href="group__serial.html#g16cb3d898e0ece4b4ee49c72ad6b1a36" title="Write a block of data to the Serial port.">Serial_Write</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a>, (uchar*)buf, strlen(buf), 0 );
<a name="l00395"></a>00395     <a class="code" href="group___tasks.html#g9a64a7c0e24f257826103d1d1bbb44fa" title="Put a task to sleep for a given number of milliseconds.">Sleep</a>(50);
<a name="l00396"></a>00396     <a class="code" href="group__serial.html#g3d7106c6d8a6bff65ab26447d34d5e2a" title="Clear out the serial port.">Serial_Flush</a>( <a class="code" href="group__serial.html#g23fd4730a5f1e2919f884ed9d71d339e" title="Index to be used to specify serial port 0.">SERIAL_0</a> ); <span class="comment">// rip the OKs out of there</span>
<a name="l00397"></a>00397   }
<a name="l00398"></a>00398   <span class="keywordflow">else</span>
<a name="l00399"></a>00399   {
<a name="l00400"></a>00400     <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l00401"></a>00401     uint8 params[4];
<a name="l00402"></a>00402     memset( params, 0, 4 );
<a name="l00403"></a>00403     <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0, <span class="stringliteral">"AP"</span>, params, 4 );
<a name="l00404"></a>00404     <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 4 );
<a name="l00405"></a>00405   }
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 <span class="comment"></span>
<a name="l00408"></a>00408 <span class="comment">/** </span>
<a name="l00409"></a>00409 <span class="comment">  Query whether the module is in API mode.</span>
<a name="l00410"></a>00410 <span class="comment">  This will block for up to a 1/2 second waiting for a response from the XBee module.</span>
<a name="l00411"></a>00411 <span class="comment">  @return 0 if off, 1 if enabled, 2 if enabled with escape characters.</span>
<a name="l00412"></a>00412 <span class="comment">  </span>
<a name="l00413"></a>00413 <span class="comment">  \par Example</span>
<a name="l00414"></a>00414 <span class="comment">  \code</span>
<a name="l00415"></a>00415 <span class="comment">  int mode = XBeeConfig_RequestPacketApiMode( );</span>
<a name="l00416"></a>00416 <span class="comment">  if( mode &gt;= 0 )</span>
<a name="l00417"></a>00417 <span class="comment">  {</span>
<a name="l00418"></a>00418 <span class="comment">    // then we have our mode</span>
<a name="l00419"></a>00419 <span class="comment">  }</span>
<a name="l00420"></a>00420 <span class="comment">  \endcode</span>
<a name="l00421"></a>00421 <span class="comment">*/</span>
<a name="l00422"></a><a class="code" href="group___x_bee.html#g5d8c12d4fba507727eded9aad78f5126">00422</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#g5d8c12d4fba507727eded9aad78f5126" title="Query whether the module is in API mode.">XBeeConfig_RequestPacketApiMode</a>( )
<a name="l00423"></a>00423 {
<a name="l00424"></a>00424   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l00425"></a>00425   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0x52, <span class="stringliteral">"AP"</span>, NULL, 0 );
<a name="l00426"></a>00426   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 0 );
<a name="l00427"></a>00427   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 <span class="comment"></span>
<a name="l00430"></a>00430 <span class="comment">/** </span>
<a name="l00431"></a>00431 <span class="comment">  A convenience function for creating an AT command packet.</span>
<a name="l00432"></a>00432 <span class="comment">  As per the XBee spec, AT Command packets that want to set/write a value must have 4 bytes of data.  </span>
<a name="l00433"></a>00433 <span class="comment">  Packets that query the value of an AT parameter send 0 bytes of data.  Note that multi-byte</span>
<a name="l00434"></a>00434 <span class="comment">  data must be sent \b big-endian (most significant byte first) - see XBee_IntToBigEndianArray( ).</span>
<a name="l00435"></a>00435 <span class="comment">  </span>
<a name="l00436"></a>00436 <span class="comment">  Make sure you're in API mode before creating &amp; sending packets - see XBeeConfig_SetPacketApiMode( ).</span>
<a name="l00437"></a>00437 <span class="comment">  See the XBee documentation for the official list of AT commands that the XBee modules understand.</span>
<a name="l00438"></a>00438 <span class="comment">  @param packet The XBeePacket to create.</span>
<a name="l00439"></a>00439 <span class="comment">  @param frameID The frame ID for this packet that subsequent response/status messages can refer to.</span>
<a name="l00440"></a>00440 <span class="comment">  @param cmd The 2-character AT command.</span>
<a name="l00441"></a>00441 <span class="comment">  @param params A pointer to the buffer containing the data to be sent.</span>
<a name="l00442"></a>00442 <span class="comment">  @param datalength The number of bytes to send from the params buffer.</span>
<a name="l00443"></a>00443 <span class="comment">  </span>
<a name="l00444"></a>00444 <span class="comment">  \par Example - Writing</span>
<a name="l00445"></a>00445 <span class="comment">  \code</span>
<a name="l00446"></a>00446 <span class="comment">  XBeePacket txPacket;</span>
<a name="l00447"></a>00447 <span class="comment">  uint8 params[4];</span>
<a name="l00448"></a>00448 <span class="comment">  XBee_IntToBigEndianArray( 1000, params ); // set our sampling rate to 1000</span>
<a name="l00449"></a>00449 <span class="comment">  XBee_CreateATCommandPacket( &amp;txPacket, 0, "IR", &amp;params, 4 ); // set the sampling rate of the IO pins</span>
<a name="l00450"></a>00450 <span class="comment">  XBee_SendPacket( &amp;txPacket, 4 );</span>
<a name="l00451"></a>00451 <span class="comment">  \endcode</span>
<a name="l00452"></a>00452 <span class="comment"></span>
<a name="l00453"></a>00453 <span class="comment">  \par Example - Reading</span>
<a name="l00454"></a>00454 <span class="comment">  \code</span>
<a name="l00455"></a>00455 <span class="comment">  XBeePacket txPacket;</span>
<a name="l00456"></a>00456 <span class="comment">  XBee_CreateATCommandPacket( &amp;txPacket, 0, "IR", NULL, 0 ); // query the sampling rate of the IO pins</span>
<a name="l00457"></a>00457 <span class="comment">  XBee_SendPacket( &amp;txPacket, 0 );</span>
<a name="l00458"></a>00458 <span class="comment">  // then we'll receive a response packet</span>
<a name="l00459"></a>00459 <span class="comment">  \endcode</span>
<a name="l00460"></a>00460 <span class="comment">*/</span>
<a name="l00461"></a><a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008">00461</a> <span class="keywordtype">void</span> <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* packet, uint8 frameID, <span class="keywordtype">char</span>* cmd, uint8* params, uint8 datalength )
<a name="l00462"></a>00462 {
<a name="l00463"></a>00463   packet-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> = <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d842a4dbaff63642056a3122db51c043413" title="An AT command packet.">XBEE_ATCOMMAND</a>;
<a name="l00464"></a>00464   packet-&gt;<a class="code" href="struct_x_bee_packet.html#1e0ba77518aa44f9718f225a522d4bf2" title="AT Command packet.">atCommand</a>.<a class="code" href="struct_x_bee___a_t_command.html#cdff9e3a4692db203e35558c1f3bd2d8" title="the ID for this packet that subsequent response/status messages can refer to.">frameID</a> = frameID;
<a name="l00465"></a>00465   uint8* p = packet-&gt;<a class="code" href="struct_x_bee_packet.html#1e0ba77518aa44f9718f225a522d4bf2" title="AT Command packet.">atCommand</a>.<a class="code" href="struct_x_bee___a_t_command.html#f328db2f815830da64d0e7672467f549" title="the 2-character AT command.">command</a>;
<a name="l00466"></a>00466   *p++ = *cmd++;
<a name="l00467"></a>00467   *p++ = *cmd;
<a name="l00468"></a>00468   p = packet-&gt;<a class="code" href="struct_x_bee_packet.html#1e0ba77518aa44f9718f225a522d4bf2" title="AT Command packet.">atCommand</a>.<a class="code" href="struct_x_bee___a_t_command.html#90905d9cf337ccdd9928e589e7799fa8" title="a buffer that holds the value of the AT command.">parameters</a>;
<a name="l00469"></a>00469   <span class="keywordflow">while</span>( datalength-- )
<a name="l00470"></a>00470     *p++ = *params++;
<a name="l00471"></a>00471 }
<a name="l00472"></a>00472 <span class="comment"></span>
<a name="l00473"></a>00473 <span class="comment">/** </span>
<a name="l00474"></a>00474 <span class="comment">  Query the address of the module.</span>
<a name="l00475"></a>00475 <span class="comment">  This will block for up to a 1/2 second waiting for a response from the XBee module.</span>
<a name="l00476"></a>00476 <span class="comment">  @return An integer corresponding to the address of the module, or negative number on failure.</span>
<a name="l00477"></a>00477 <span class="comment">  </span>
<a name="l00478"></a>00478 <span class="comment">  \par Example</span>
<a name="l00479"></a>00479 <span class="comment">  \code</span>
<a name="l00480"></a>00480 <span class="comment">  int address = XBeeConfig_RequestAddress( );</span>
<a name="l00481"></a>00481 <span class="comment">  if( address &gt;= 0 )</span>
<a name="l00482"></a>00482 <span class="comment">  {</span>
<a name="l00483"></a>00483 <span class="comment">    // then we have our address</span>
<a name="l00484"></a>00484 <span class="comment">  }</span>
<a name="l00485"></a>00485 <span class="comment">  \endcode</span>
<a name="l00486"></a>00486 <span class="comment">*/</span>
<a name="l00487"></a><a class="code" href="group___x_bee.html#g2f0a97c1a7ce219eb7ccd807e8a860e2">00487</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#g2f0a97c1a7ce219eb7ccd807e8a860e2" title="Query the address of the module.">XBeeConfig_RequestATResponse</a>( <span class="keywordtype">char</span>* cmd )
<a name="l00488"></a>00488 {
<a name="l00489"></a>00489   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l00490"></a>00490   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0x52, cmd, NULL, 0 );
<a name="l00491"></a>00491   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 0 );
<a name="l00492"></a>00492   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 <span class="comment"></span>
<a name="l00495"></a>00495 <span class="comment">/** </span>
<a name="l00496"></a>00496 <span class="comment">  Configure the IO settings on an XBee module.</span>
<a name="l00497"></a>00497 <span class="comment">  IO pins can have one of 5 values:</span>
<a name="l00498"></a>00498 <span class="comment">  - \b XBEE_IO_DISABLED</span>
<a name="l00499"></a>00499 <span class="comment">  - \b XBEE_IO_ANALOGIN - Analog input (10-bit)</span>
<a name="l00500"></a>00500 <span class="comment">  - \b XBEE_IO_DIGITALIN - Digital input</span>
<a name="l00501"></a>00501 <span class="comment">  - \b XBEE_IO_DIGOUT_HIGH - Digital out high</span>
<a name="l00502"></a>00502 <span class="comment">  - \b XBEE_IO_DIGOUT_LOW - Digital out low</span>
<a name="l00503"></a>00503 <span class="comment">  @param pin An integer specifying which pin to configure. There are 9 IO pins (numbered 0-8) on the XBee modules.  </span>
<a name="l00504"></a>00504 <span class="comment">  Only channels 0-7 can be analog inputs - channel 8 can only operate as a digital in or out.</span>
<a name="l00505"></a>00505 <span class="comment">  @param value An int specifying the behavior of this pin (options shown above).</span>
<a name="l00506"></a>00506 <span class="comment">  \par Example</span>
<a name="l00507"></a>00507 <span class="comment">  \code</span>
<a name="l00508"></a>00508 <span class="comment">  // set channel 0 to analog in</span>
<a name="l00509"></a>00509 <span class="comment">  XBeeConfig_SetIO( 0, XBEE_IO_ANALOGIN );</span>
<a name="l00510"></a>00510 <span class="comment">  \endcode</span>
<a name="l00511"></a>00511 <span class="comment">*/</span>
<a name="l00512"></a><a class="code" href="group___x_bee.html#g2a1939254f9174e0ee2c33a4d2ff8ba3">00512</a> <span class="keywordtype">void</span> <a class="code" href="group___x_bee.html#g2a1939254f9174e0ee2c33a4d2ff8ba3" title="Configure the IO settings on an XBee module.">XBeeConfig_SetIO</a>( <span class="keywordtype">int</span> pin, <span class="keywordtype">int</span> value )
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> packet;
<a name="l00515"></a>00515   <a class="code" href="group___x_bee.html#g066e28d0aaafb23eb1171bcdb31e5c45" title="Initialize a packet before reading into it.">XBee_ResetPacket</a>( &amp;packet );
<a name="l00516"></a>00516   uint8 params[4];
<a name="l00517"></a>00517   <span class="keywordtype">char</span> cmd[2];
<a name="l00518"></a>00518   sprintf( cmd, <span class="stringliteral">"D%d"</span>, pin );
<a name="l00519"></a>00519   <a class="code" href="group___x_bee.html#gd357b57c2604013a69ec60e746318f89" title="Convert a 32-bit integer into a big endian array of 4 unsigned 8-bit integers.">XBee_IntToBigEndianArray</a>( value, params );
<a name="l00520"></a>00520   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;packet, 0, cmd, params, 4 );
<a name="l00521"></a>00521   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;packet, 4 );
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 <span class="comment"></span>
<a name="l00524"></a>00524 <span class="comment">/** </span>
<a name="l00525"></a>00525 <span class="comment">  Query the configuration of an IO pin.</span>
<a name="l00526"></a>00526 <span class="comment">  See XBeeConfig_SetIO( ) for the possible return values.</span>
<a name="l00527"></a>00527 <span class="comment">  This will block for up to a 1/2 second waiting for a response from the XBee module.</span>
<a name="l00528"></a>00528 <span class="comment">  @return An integer corresponding to the config of the requested pin, or negative number on failure.</span>
<a name="l00529"></a>00529 <span class="comment">  </span>
<a name="l00530"></a>00530 <span class="comment">  \par Example</span>
<a name="l00531"></a>00531 <span class="comment">  \code</span>
<a name="l00532"></a>00532 <span class="comment">  int pin = XBeeConfig_RequestIO( 0 ); // request the configuration of pin 0</span>
<a name="l00533"></a>00533 <span class="comment">  if( pin &gt;= 0 )</span>
<a name="l00534"></a>00534 <span class="comment">  {</span>
<a name="l00535"></a>00535 <span class="comment">    // then we have our pin config</span>
<a name="l00536"></a>00536 <span class="comment">  }</span>
<a name="l00537"></a>00537 <span class="comment">  \endcode</span>
<a name="l00538"></a>00538 <span class="comment">*/</span>
<a name="l00539"></a><a class="code" href="group___x_bee.html#g471f419a8be85dff56cb190ac1122df3">00539</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#g471f419a8be85dff56cb190ac1122df3" title="Query the configuration of an IO pin.">XBeeConfig_RequestIO</a>( <span class="keywordtype">int</span> pin )
<a name="l00540"></a>00540 {
<a name="l00541"></a>00541   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l00542"></a>00542   <span class="keywordtype">char</span> cmd[2];
<a name="l00543"></a>00543   sprintf( cmd, <span class="stringliteral">"D%d"</span>, pin );
<a name="l00544"></a>00544   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0x52, cmd, NULL, 0 );
<a name="l00545"></a>00545   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 0 );
<a name="l00546"></a>00546   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 <span class="comment"></span>
<a name="l00549"></a>00549 <span class="comment">/** </span>
<a name="l00550"></a>00550 <span class="comment">  Create a packet to be transmitted with a 16-bit address.</span>
<a name="l00551"></a>00551 <span class="comment">  If the \b frameID is 0, you won't receive a TX Status message in response.</span>
<a name="l00552"></a>00552 <span class="comment"></span>
<a name="l00553"></a>00553 <span class="comment">  @param xbp The XBeePacket to create.</span>
<a name="l00554"></a>00554 <span class="comment">  @param frameID The frame ID for this packet that subsequent response/status messages can refer to.  Set to 0 for no response.</span>
<a name="l00555"></a>00555 <span class="comment">  @param destination The destination address for this packet.  Broadcast Address: 0xFFFF.</span>
<a name="l00556"></a>00556 <span class="comment">  @param options The XBee options for this packet (0 if none).</span>
<a name="l00557"></a>00557 <span class="comment">  @param data A pointer to the data to be sent in this packet.  Up to 100 bytes.</span>
<a name="l00558"></a>00558 <span class="comment">  @param datalength The number of bytes of data to be sent. Maximum 100 bytes.</span>
<a name="l00559"></a>00559 <span class="comment">  @return True on success, false on failure.</span>
<a name="l00560"></a>00560 <span class="comment">  </span>
<a name="l00561"></a>00561 <span class="comment">  \par Example</span>
<a name="l00562"></a>00562 <span class="comment">  \code</span>
<a name="l00563"></a>00563 <span class="comment">  XBeePacket txPacket;</span>
<a name="l00564"></a>00564 <span class="comment">  uint8 data[] = "ABC";</span>
<a name="l00565"></a>00565 <span class="comment">  XBee_CreateTX16Packet( &amp;txPacket, 0x52, 0, 0, data, 3 );</span>
<a name="l00566"></a>00566 <span class="comment">  XBee_SendPacket( &amp;txPacket, 3 );</span>
<a name="l00567"></a>00567 <span class="comment">  \endcode</span>
<a name="l00568"></a>00568 <span class="comment">*/</span>
<a name="l00569"></a><a class="code" href="group___x_bee.html#g64d16869ea926373568cc1c09c53b0fa">00569</a> <span class="keywordtype">bool</span> <a class="code" href="group___x_bee.html#g64d16869ea926373568cc1c09c53b0fa" title="Create a packet to be transmitted with a 16-bit address.">XBee_CreateTX16Packet</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* xbp, uint8 frameID, uint16 destination, uint8 options, uint8* data, uint8 datalength )
<a name="l00570"></a>00570 {
<a name="l00571"></a>00571   xbp-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> = <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d8437b041bc71f64cf55502e3266ef463af" title="An outgoing data packet with a 16-bit address.">XBEE_TX16</a>;
<a name="l00572"></a>00572   xbp-&gt;<a class="code" href="struct_x_bee_packet.html#1ca2e9c1eda8ec6e6cfb65115537b69e" title="TX 16 packet.">tx16</a>.<a class="code" href="struct_x_bee___t_x16.html#6a16a9d2732176756db38dc77e478a57" title="the ID for this packet that subsequent response/status messages can refer to.">frameID</a> = frameID;
<a name="l00573"></a>00573   xbp-&gt;<a class="code" href="struct_x_bee_packet.html#1ca2e9c1eda8ec6e6cfb65115537b69e" title="TX 16 packet.">tx16</a>.<a class="code" href="struct_x_bee___t_x16.html#12a72704ebfe463f13f7bea0d218c261" title="the 16-bit (2-byte) address of the destination.">destination</a>[0] = destination &gt;&gt; 8;
<a name="l00574"></a>00574   xbp-&gt;<a class="code" href="struct_x_bee_packet.html#1ca2e9c1eda8ec6e6cfb65115537b69e" title="TX 16 packet.">tx16</a>.<a class="code" href="struct_x_bee___t_x16.html#12a72704ebfe463f13f7bea0d218c261" title="the 16-bit (2-byte) address of the destination.">destination</a>[1] = destination &amp; 0xFF;
<a name="l00575"></a>00575   xbp-&gt;<a class="code" href="struct_x_bee_packet.html#1ca2e9c1eda8ec6e6cfb65115537b69e" title="TX 16 packet.">tx16</a>.<a class="code" href="struct_x_bee___t_x16.html#830c53ff47f03014bb38cb296e108575" title="0x01 (disable ACK) or 0x04 (Send with Broadcast PAN ID).">options</a> = options;
<a name="l00576"></a>00576   xbp-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> = datalength + 5;
<a name="l00577"></a>00577   uint8* p = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#1ca2e9c1eda8ec6e6cfb65115537b69e" title="TX 16 packet.">tx16</a>.<a class="code" href="struct_x_bee___t_x16.html#e349d49e1420bf6e7898072f8113f115" title="a buffer containing the value of the outgoing packet.">data</a>;
<a name="l00578"></a>00578   <span class="keywordflow">while</span>( datalength-- )
<a name="l00579"></a>00579     *p++ = *data++;
<a name="l00580"></a>00580   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00581"></a>00581 }
<a name="l00582"></a>00582 <span class="comment"></span>
<a name="l00583"></a>00583 <span class="comment">/** </span>
<a name="l00584"></a>00584 <span class="comment">  Create a packet to be transmitted with a 64-bit address.</span>
<a name="l00585"></a>00585 <span class="comment"></span>
<a name="l00586"></a>00586 <span class="comment">  @param xbp The XBeePacket to create.</span>
<a name="l00587"></a>00587 <span class="comment">  @param frameID The frame ID for this packet that subsequent response/status messages can refer to.  Set to 0 for no response.</span>
<a name="l00588"></a>00588 <span class="comment">  @param destination The destination address for this packet.  Broadcast Address: 0xFFFF (same as 16b broadcast address)</span>
<a name="l00589"></a>00589 <span class="comment">  @param options The XBee options for this packet (0 if none).</span>
<a name="l00590"></a>00590 <span class="comment">  @param data A pointer to the data to be sent in this packet.  Up to 100 bytes.</span>
<a name="l00591"></a>00591 <span class="comment">  @param datalength The number of bytes of data to be sent. Maximum 100 bytes.</span>
<a name="l00592"></a>00592 <span class="comment">  @return True on success, false on failure.</span>
<a name="l00593"></a>00593 <span class="comment">  </span>
<a name="l00594"></a>00594 <span class="comment">  \par Example</span>
<a name="l00595"></a>00595 <span class="comment">  \code</span>
<a name="l00596"></a>00596 <span class="comment">  XBeePacket txPacket;</span>
<a name="l00597"></a>00597 <span class="comment">  uint8 data[] = "ABCDE";</span>
<a name="l00598"></a>00598 <span class="comment">  XBee_CreateTX16Packet( &amp;txPacket, 0, 0, 0, data, 5 );</span>
<a name="l00599"></a>00599 <span class="comment">  XBee_SendPacket( &amp;txPacket, 5 );</span>
<a name="l00600"></a>00600 <span class="comment">  \endcode</span>
<a name="l00601"></a>00601 <span class="comment">*/</span>
<a name="l00602"></a><a class="code" href="group___x_bee.html#gda9cdb29dfffba8aea12c8f9e5586237">00602</a> <span class="keywordtype">bool</span> <a class="code" href="group___x_bee.html#gda9cdb29dfffba8aea12c8f9e5586237" title="Create a packet to be transmitted with a 64-bit address.">XBee_CreateTX64Packet</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* xbp, uint8 frameID, uint64 destination, uint8 options, uint8* data, uint8 datalength )
<a name="l00603"></a>00603 {
<a name="l00604"></a>00604   uint8* p;
<a name="l00605"></a>00605   <span class="keywordtype">int</span> i;
<a name="l00606"></a>00606   xbp-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> = <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d8462a2ace5ba813e594cedb623355792b8" title="An outgoing data packet with a 64-bit address.">XBEE_TX64</a>;
<a name="l00607"></a>00607   xbp-&gt;<a class="code" href="struct_x_bee_packet.html#b45b4b40af7f8c9afcc31b45bf183f50" title="TX 64 packet.">tx64</a>.<a class="code" href="struct_x_bee___t_x64.html#7ff7deb80b81bb36eef700ee6f355ea9" title="the ID for this packet that subsequent response/status messages can refer to.">frameID</a> = frameID;
<a name="l00608"></a>00608   <span class="keywordflow">for</span>( i = 0; i &lt; 8; i++ )
<a name="l00609"></a>00609     xbp-&gt;<a class="code" href="struct_x_bee_packet.html#b45b4b40af7f8c9afcc31b45bf183f50" title="TX 64 packet.">tx64</a>.<a class="code" href="struct_x_bee___t_x64.html#4377ed559976b9930dc9b1c069983681" title="the 64-bit (8-byte) address of the destination.">destination</a>[i] = (destination &gt;&gt; 8*i) &amp; (0xFF * i); <span class="comment">// ????????</span>
<a name="l00610"></a>00610   xbp-&gt;<a class="code" href="struct_x_bee_packet.html#b45b4b40af7f8c9afcc31b45bf183f50" title="TX 64 packet.">tx64</a>.<a class="code" href="struct_x_bee___t_x64.html#51cef8926622eebdad03f8a30e608112" title="0x01 (disable ACK) or 0x04 (Send with Broadcast PAN ID).">options</a> = options;
<a name="l00611"></a>00611   xbp-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> = datalength + 5;
<a name="l00612"></a>00612   p = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#b45b4b40af7f8c9afcc31b45bf183f50" title="TX 64 packet.">tx64</a>.<a class="code" href="struct_x_bee___t_x64.html#d0b27b2d59a999e12435d8c64906a328" title="a buffer containing the value of the outgoing packet.">data</a>;
<a name="l00613"></a>00613   <span class="keywordflow">while</span>( datalength-- )
<a name="l00614"></a>00614     *p++ = *data++;
<a name="l00615"></a>00615   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00616"></a>00616 }
<a name="l00617"></a>00617 <span class="comment"></span>
<a name="l00618"></a>00618 <span class="comment">/** </span>
<a name="l00619"></a>00619 <span class="comment">  Unpack the info from an incoming packet with a 16-bit address.</span>
<a name="l00620"></a>00620 <span class="comment">  Pass \b NULL into any of the parameters you don't care about.</span>
<a name="l00621"></a>00621 <span class="comment">  @param xbp The XBeePacket to read from.</span>
<a name="l00622"></a>00622 <span class="comment">  @param srcAddress The 16-bit address of this packet.</span>
<a name="l00623"></a>00623 <span class="comment">  @param sigstrength The signal strength of this packet.</span>
<a name="l00624"></a>00624 <span class="comment">  @param options The XBee options for this packet.</span>
<a name="l00625"></a>00625 <span class="comment">  @param data A pointer that will be set to the data of this packet.</span>
<a name="l00626"></a>00626 <span class="comment">  @param datalength The length of data in this packet.</span>
<a name="l00627"></a>00627 <span class="comment">  @return True on success, false on failure.</span>
<a name="l00628"></a>00628 <span class="comment">  </span>
<a name="l00629"></a>00629 <span class="comment">  \par Example</span>
<a name="l00630"></a>00630 <span class="comment">  \code</span>
<a name="l00631"></a>00631 <span class="comment">  XBeePacket rxPacket;</span>
<a name="l00632"></a>00632 <span class="comment">  if( XBee_GetPacket( &amp;rxPacket, 0 ) )</span>
<a name="l00633"></a>00633 <span class="comment">  {</span>
<a name="l00634"></a>00634 <span class="comment">    uint16 src;</span>
<a name="l00635"></a>00635 <span class="comment">    uint8 sigstrength;</span>
<a name="l00636"></a>00636 <span class="comment">    uint8* data;</span>
<a name="l00637"></a>00637 <span class="comment">    uint8 datalength;</span>
<a name="l00638"></a>00638 <span class="comment">    if( XBee_ReadRX16Packet( &amp;rxPacket, &amp;src, &amp;sigstrength, NULL, &amp;data, &amp;datalength ) )</span>
<a name="l00639"></a>00639 <span class="comment">    {</span>
<a name="l00640"></a>00640 <span class="comment">      // then process the new packet here</span>
<a name="l00641"></a>00641 <span class="comment">      XBee_ResetPacket( &amp;rxPacket ); // and clear it out before reading again</span>
<a name="l00642"></a>00642 <span class="comment">    }</span>
<a name="l00643"></a>00643 <span class="comment">  }</span>
<a name="l00644"></a>00644 <span class="comment">  \endcode</span>
<a name="l00645"></a>00645 <span class="comment">*/</span>
<a name="l00646"></a><a class="code" href="group___x_bee.html#g90063926b2e0055e8476887828e8eaa4">00646</a> <span class="keywordtype">bool</span> <a class="code" href="group___x_bee.html#g90063926b2e0055e8476887828e8eaa4" title="Unpack the info from an incoming packet with a 16-bit address.">XBee_ReadRX16Packet</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* xbp, uint16* srcAddress, uint8* sigstrength, uint8* options, uint8** data, uint8* datalength )
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648   <span class="keywordflow">if</span>( xbp-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> != <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d846f28614466ea9fcf78dc3e10c806275c" title="An incoming data packet with a 16-bit address.">XBEE_RX16</a> )
<a name="l00649"></a>00649     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00650"></a>00650 
<a name="l00651"></a>00651   <span class="keywordflow">if</span>( srcAddress )
<a name="l00652"></a>00652   {
<a name="l00653"></a>00653     *srcAddress = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#46cc287442fc202b032b1864e2c5c419" title="RX 16 packet.">rx16</a>.<a class="code" href="struct_x_bee___r_x16.html#1dffd1837c62c47aa1784a5b3e4c5801" title="the 16-bit (2-byte) address of the sender.">source</a>[0];
<a name="l00654"></a>00654     *srcAddress &lt;&lt;= 8;
<a name="l00655"></a>00655     *srcAddress += xbp-&gt;<a class="code" href="struct_x_bee_packet.html#46cc287442fc202b032b1864e2c5c419" title="RX 16 packet.">rx16</a>.<a class="code" href="struct_x_bee___r_x16.html#1dffd1837c62c47aa1784a5b3e4c5801" title="the 16-bit (2-byte) address of the sender.">source</a>[1];
<a name="l00656"></a>00656   }
<a name="l00657"></a>00657   <span class="keywordflow">if</span>( sigstrength )
<a name="l00658"></a>00658     *sigstrength = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#46cc287442fc202b032b1864e2c5c419" title="RX 16 packet.">rx16</a>.<a class="code" href="struct_x_bee___r_x16.html#2de0e14b59afd8cafeabd43e719b35f4" title="the signal strength of the received message.">rssi</a>;
<a name="l00659"></a>00659   <span class="keywordflow">if</span>( options )
<a name="l00660"></a>00660     *options = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#46cc287442fc202b032b1864e2c5c419" title="RX 16 packet.">rx16</a>.<a class="code" href="struct_x_bee___r_x16.html#3d7bd9d1b6829cdfb78977d93ad0f60f" title="bit 1 is Address Broadcast, bit 2 is PAN broadcast.">options</a>;
<a name="l00661"></a>00661   <span class="keywordflow">if</span>( data )
<a name="l00662"></a>00662     *data = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#46cc287442fc202b032b1864e2c5c419" title="RX 16 packet.">rx16</a>.<a class="code" href="struct_x_bee___r_x16.html#e69e7b149d147da784d3982039385fb7" title="a buffer containing the value of the incoming packet.">data</a>;
<a name="l00663"></a>00663   <span class="keywordflow">if</span>( datalength )
<a name="l00664"></a>00664     *datalength = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> - 5;
<a name="l00665"></a>00665   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00666"></a>00666 }
<a name="l00667"></a>00667 <span class="comment"></span>
<a name="l00668"></a>00668 <span class="comment">/** </span>
<a name="l00669"></a>00669 <span class="comment">  Unpack the info from an incoming packet with a 64-bit address.</span>
<a name="l00670"></a>00670 <span class="comment">  Pass \b NULL into any of the parameters you don't care about.</span>
<a name="l00671"></a>00671 <span class="comment">  @param xbp The XBeePacket to read from.</span>
<a name="l00672"></a>00672 <span class="comment">  @param srcAddress The 64-bit address of this packet.</span>
<a name="l00673"></a>00673 <span class="comment">  @param sigstrength The signal strength of this packet.</span>
<a name="l00674"></a>00674 <span class="comment">  @param options The XBee options for this packet.</span>
<a name="l00675"></a>00675 <span class="comment">  @param data A pointer that will be set to the data of this packet.</span>
<a name="l00676"></a>00676 <span class="comment">  @param datalength The length of data in this packet.</span>
<a name="l00677"></a>00677 <span class="comment">  @return True on success, false on failure.</span>
<a name="l00678"></a>00678 <span class="comment">  </span>
<a name="l00679"></a>00679 <span class="comment">  \par Example</span>
<a name="l00680"></a>00680 <span class="comment">  \code</span>
<a name="l00681"></a>00681 <span class="comment">  XBeePacket rxPacket;</span>
<a name="l00682"></a>00682 <span class="comment">  if( XBee_GetPacket( &amp;rxPacket, 0 ) )</span>
<a name="l00683"></a>00683 <span class="comment">  {</span>
<a name="l00684"></a>00684 <span class="comment">    uint64 src;</span>
<a name="l00685"></a>00685 <span class="comment">    uint8 sigstrength;</span>
<a name="l00686"></a>00686 <span class="comment">    uint8* data;</span>
<a name="l00687"></a>00687 <span class="comment">    uint8 datalength;</span>
<a name="l00688"></a>00688 <span class="comment">    if( XBee_ReadRX64Packet( &amp;rxPacket, &amp;src, &amp;sigstrength, NULL, &amp;data, &amp;datalength ) )</span>
<a name="l00689"></a>00689 <span class="comment">    {</span>
<a name="l00690"></a>00690 <span class="comment">      // then process the new packet here</span>
<a name="l00691"></a>00691 <span class="comment">      XBee_ResetPacket( &amp;rxPacket ); // and clear it out before reading again</span>
<a name="l00692"></a>00692 <span class="comment">    }</span>
<a name="l00693"></a>00693 <span class="comment">  }</span>
<a name="l00694"></a>00694 <span class="comment">  \endcode</span>
<a name="l00695"></a>00695 <span class="comment">*/</span>
<a name="l00696"></a><a class="code" href="group___x_bee.html#g366e1d12df63ac0bb6b4fbf380c9311c">00696</a> <span class="keywordtype">bool</span> <a class="code" href="group___x_bee.html#g366e1d12df63ac0bb6b4fbf380c9311c" title="Unpack the info from an incoming packet with a 64-bit address.">XBee_ReadRX64Packet</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* xbp, uint64* srcAddress, uint8* sigstrength, uint8* options, uint8** data, uint8* datalength )
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698   <span class="keywordflow">if</span>( xbp-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> != <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d8416930034c81dfe130a62551a9272ba71" title="An incoming data packet with a 64-bit address.">XBEE_RX64</a> )
<a name="l00699"></a>00699     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701   <span class="keywordtype">int</span> i;
<a name="l00702"></a>00702   <span class="keywordflow">if</span>( srcAddress )
<a name="l00703"></a>00703   {
<a name="l00704"></a>00704     <span class="keywordflow">for</span>( i = 0; i &lt; 8; i++ )
<a name="l00705"></a>00705     {
<a name="l00706"></a>00706       *srcAddress &lt;&lt;= i*8;
<a name="l00707"></a>00707       *srcAddress += xbp-&gt;<a class="code" href="struct_x_bee_packet.html#aa6b4f0c9b73130bd3518e3b97386a7c" title="RX 64 packet.">rx64</a>.<a class="code" href="struct_x_bee___r_x64.html#cfa017bf263cea0baad1f21a21bb0364" title="the 64-bit (8-byte) address of the sender.">source</a>[i];
<a name="l00708"></a>00708     }
<a name="l00709"></a>00709   }
<a name="l00710"></a>00710   <span class="keywordflow">if</span>( sigstrength )
<a name="l00711"></a>00711     *sigstrength = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#aa6b4f0c9b73130bd3518e3b97386a7c" title="RX 64 packet.">rx64</a>.<a class="code" href="struct_x_bee___r_x64.html#bba5569e1532719f5401be27bc527cd7" title="the signal strength of the received message.">rssi</a>;
<a name="l00712"></a>00712   <span class="keywordflow">if</span>( options )
<a name="l00713"></a>00713     *options = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#aa6b4f0c9b73130bd3518e3b97386a7c" title="RX 64 packet.">rx64</a>.<a class="code" href="struct_x_bee___r_x64.html#7be7cb63abfc8b00bc6f3612d04ab1cf" title="bit 1 is Address Broadcast, bit 2 is PAN broadcast.">options</a>;
<a name="l00714"></a>00714   <span class="keywordflow">if</span>( data )
<a name="l00715"></a>00715     *data = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#aa6b4f0c9b73130bd3518e3b97386a7c" title="RX 64 packet.">rx64</a>.<a class="code" href="struct_x_bee___r_x64.html#81daa27001bf1adb4a4614459329a723" title="a buffer containing the value of the incoming packet.">data</a>;
<a name="l00716"></a>00716   <span class="keywordflow">if</span>( datalength )
<a name="l00717"></a>00717     *datalength = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> - 11;
<a name="l00718"></a>00718   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 <span class="comment"></span>
<a name="l00721"></a>00721 <span class="comment">/** </span>
<a name="l00722"></a>00722 <span class="comment">  Unpack the info from an incoming IO packet with a 16-bit address.</span>
<a name="l00723"></a>00723 <span class="comment">  When an XBee module has been given a sample rate, it will sample its IO pins according to their current configuration</span>
<a name="l00724"></a>00724 <span class="comment">  and send an IO packet with the sample data.  This function will extract the sample info into an array of ints for you.</span>
<a name="l00725"></a>00725 <span class="comment">  There are 9 IO pins on the XBee modules, so be sure that the array you pass in has room for 9 ints.</span>
<a name="l00726"></a>00726 <span class="comment"></span>
<a name="l00727"></a>00727 <span class="comment">  Pass \b NULL into any of the parameters you don't care about.</span>
<a name="l00728"></a>00728 <span class="comment">  @param xbp The XBeePacket to read from.</span>
<a name="l00729"></a>00729 <span class="comment">  @param srcAddress A pointer to a uint16 that will be filled up with the 16-bit address of this packet.</span>
<a name="l00730"></a>00730 <span class="comment">  @param sigstrength A pointer to a uint8 that will be filled up with the signal strength of this packet.</span>
<a name="l00731"></a>00731 <span class="comment">  @param options A pointer to a uint8 that will be filled up with the XBee options for this packet.</span>
<a name="l00732"></a>00732 <span class="comment">  @param samples A pointer to an array of ints that will be filled up with the sample values from this packet.</span>
<a name="l00733"></a>00733 <span class="comment">  @return True on success, false on failure.</span>
<a name="l00734"></a>00734 <span class="comment">  @see XBeeConfig_SetSampleRate( ), XBeeConfig_SetIOs( )</span>
<a name="l00735"></a>00735 <span class="comment">  </span>
<a name="l00736"></a>00736 <span class="comment">  \par Example</span>
<a name="l00737"></a>00737 <span class="comment">  \code</span>
<a name="l00738"></a>00738 <span class="comment">  XBeePacket rxPacket;</span>
<a name="l00739"></a>00739 <span class="comment">  if( XBee_GetPacket( &amp;rxPacket, 0 ) )</span>
<a name="l00740"></a>00740 <span class="comment">  {</span>
<a name="l00741"></a>00741 <span class="comment">    uint16 src;</span>
<a name="l00742"></a>00742 <span class="comment">    uint8 sigstrength;</span>
<a name="l00743"></a>00743 <span class="comment">    int samples[9];</span>
<a name="l00744"></a>00744 <span class="comment">    if( XBee_ReadIO16Packet( &amp;rxPacket, &amp;src, &amp;sigstrength, NULL, samples ) )</span>
<a name="l00745"></a>00745 <span class="comment">    {</span>
<a name="l00746"></a>00746 <span class="comment">      // then process the new packet here</span>
<a name="l00747"></a>00747 <span class="comment">      XBee_ResetPacket( &amp;rxPacket ); // and clear it out before reading again</span>
<a name="l00748"></a>00748 <span class="comment">    }</span>
<a name="l00749"></a>00749 <span class="comment">  }</span>
<a name="l00750"></a>00750 <span class="comment">  \endcode</span>
<a name="l00751"></a>00751 <span class="comment">*/</span>
<a name="l00752"></a><a class="code" href="group___x_bee.html#gdc33b8d4803250488422484b2129f659">00752</a> <span class="keywordtype">bool</span> <a class="code" href="group___x_bee.html#gdc33b8d4803250488422484b2129f659" title="Unpack the info from an incoming IO packet with a 16-bit address.">XBee_ReadIO16Packet</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* xbp, uint16* srcAddress, uint8* sigstrength, uint8* options, <span class="keywordtype">int</span>* samples )
<a name="l00753"></a>00753 {
<a name="l00754"></a>00754   <span class="keywordflow">if</span>( xbp-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> != <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d84ab62c1657ee730b996f8ae23316ab0f2" title="An incoming IO packet with a 16-bit address.">XBEE_IO16</a> )
<a name="l00755"></a>00755     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00756"></a>00756   <span class="keywordflow">if</span>( srcAddress )
<a name="l00757"></a>00757   {
<a name="l00758"></a>00758     *srcAddress = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#a7c7b72615863bf0558891e77ec05a09" title="IO 16 packet.">io16</a>.<a class="code" href="struct_x_bee___i_o16.html#b39bd4425d54491b3338b70b97a014ee" title="the 16-bit (2-byte) address of the sender.">source</a>[0];
<a name="l00759"></a>00759     *srcAddress &lt;&lt;= 8;
<a name="l00760"></a>00760     *srcAddress += xbp-&gt;<a class="code" href="struct_x_bee_packet.html#a7c7b72615863bf0558891e77ec05a09" title="IO 16 packet.">io16</a>.<a class="code" href="struct_x_bee___i_o16.html#b39bd4425d54491b3338b70b97a014ee" title="the 16-bit (2-byte) address of the sender.">source</a>[1];
<a name="l00761"></a>00761   }
<a name="l00762"></a>00762   <span class="keywordflow">if</span>( sigstrength )
<a name="l00763"></a>00763     *sigstrength = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#a7c7b72615863bf0558891e77ec05a09" title="IO 16 packet.">io16</a>.<a class="code" href="struct_x_bee___i_o16.html#f261d4c3658a0f878b5ec146fbb571bc" title="the signal strength of the received message.">rssi</a>;
<a name="l00764"></a>00764   <span class="keywordflow">if</span>( options )
<a name="l00765"></a>00765     *options = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#a7c7b72615863bf0558891e77ec05a09" title="IO 16 packet.">io16</a>.<a class="code" href="struct_x_bee___i_o16.html#7e5b9f70e6eb75adcd651dae5f25f160" title="bit 1 is Address Broadcast, bit 2 is PAN broadcast.">options</a>;
<a name="l00766"></a>00766   <span class="keywordflow">if</span>( samples )
<a name="l00767"></a>00767   {
<a name="l00768"></a>00768     <span class="keywordflow">if</span>( !XBee_GetIOValues( xbp, samples ) )
<a name="l00769"></a>00769       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00770"></a>00770   }
<a name="l00771"></a>00771   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00772"></a>00772 }
<a name="l00773"></a>00773 <span class="comment"></span>
<a name="l00774"></a>00774 <span class="comment">/** </span>
<a name="l00775"></a>00775 <span class="comment">  Unpack the info from an incoming IO packet with a 64-bit address.</span>
<a name="l00776"></a>00776 <span class="comment">  When an XBee module has been given a sample rate, it will sample its IO pins according to their current configuration</span>
<a name="l00777"></a>00777 <span class="comment">  and send an IO packet with the sample data.  This function will extract the sample info into an array of ints for you.</span>
<a name="l00778"></a>00778 <span class="comment">  There are 9 IO pins on the XBee modules, so be sure that the array you pass in has room for 9 ints.</span>
<a name="l00779"></a>00779 <span class="comment"></span>
<a name="l00780"></a>00780 <span class="comment">  Pass \b NULL into any of the parameters you don't care about.</span>
<a name="l00781"></a>00781 <span class="comment">  @param xbp The XBeePacket to read from.</span>
<a name="l00782"></a>00782 <span class="comment">  @param srcAddress A pointer to a uint64 that will be filled up with the 16-bit address of this packet.</span>
<a name="l00783"></a>00783 <span class="comment">  @param sigstrength A pointer to a uint8 that will be filled up with the signal strength of this packet.</span>
<a name="l00784"></a>00784 <span class="comment">  @param options A pointer to a uint8 that will be filled up with the XBee options for this packet.</span>
<a name="l00785"></a>00785 <span class="comment">  @param samples A pointer to an array of ints that will be filled up with the sample values from this packet.</span>
<a name="l00786"></a>00786 <span class="comment">  @return True on success, false on failure.</span>
<a name="l00787"></a>00787 <span class="comment">  @see XBeeConfig_SetSampleRate( ), XBeeConfig_SetIOs( )</span>
<a name="l00788"></a>00788 <span class="comment">  </span>
<a name="l00789"></a>00789 <span class="comment">  \par Example</span>
<a name="l00790"></a>00790 <span class="comment">  \code</span>
<a name="l00791"></a>00791 <span class="comment">  XBeePacket rxPacket;</span>
<a name="l00792"></a>00792 <span class="comment">  if( XBee_GetPacket( &amp;rxPacket, 0 ) )</span>
<a name="l00793"></a>00793 <span class="comment">  {</span>
<a name="l00794"></a>00794 <span class="comment">    uint64 src;</span>
<a name="l00795"></a>00795 <span class="comment">    uint8 sigstrength;</span>
<a name="l00796"></a>00796 <span class="comment">    int samples[9];</span>
<a name="l00797"></a>00797 <span class="comment">    if( XBee_ReadIO16Packet( &amp;rxPacket, &amp;src, &amp;sigstrength, NULL, samples ) )</span>
<a name="l00798"></a>00798 <span class="comment">    {</span>
<a name="l00799"></a>00799 <span class="comment">      // then process the new packet here</span>
<a name="l00800"></a>00800 <span class="comment">      XBee_ResetPacket( &amp;rxPacket ); // and clear it out before reading again</span>
<a name="l00801"></a>00801 <span class="comment">    }</span>
<a name="l00802"></a>00802 <span class="comment">  }</span>
<a name="l00803"></a>00803 <span class="comment">  \endcode</span>
<a name="l00804"></a>00804 <span class="comment">*/</span>
<a name="l00805"></a><a class="code" href="group___x_bee.html#ga54eca4b48efbf8f8080203f9930c1cd">00805</a> <span class="keywordtype">bool</span> <a class="code" href="group___x_bee.html#ga54eca4b48efbf8f8080203f9930c1cd" title="Unpack the info from an incoming IO packet with a 64-bit address.">XBee_ReadIO64Packet</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* xbp, uint64* srcAddress, uint8* sigstrength, uint8* options, <span class="keywordtype">int</span>* samples )
<a name="l00806"></a>00806 {
<a name="l00807"></a>00807   <span class="keywordflow">if</span>( xbp-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> != <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d8416930034c81dfe130a62551a9272ba71" title="An incoming data packet with a 64-bit address.">XBEE_RX64</a> )
<a name="l00808"></a>00808     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00809"></a>00809   <span class="keywordflow">if</span>( srcAddress )
<a name="l00810"></a>00810   {
<a name="l00811"></a>00811     <span class="keywordtype">int</span> i;
<a name="l00812"></a>00812     <span class="keywordflow">for</span>( i = 0; i &lt; 8; i++ )
<a name="l00813"></a>00813     {
<a name="l00814"></a>00814       *srcAddress &lt;&lt;= i*8;
<a name="l00815"></a>00815       *srcAddress += xbp-&gt;<a class="code" href="struct_x_bee_packet.html#501998ceaa8ed20fff1f6da6ed8f2c52" title="IO 64 packet.">io64</a>.<a class="code" href="struct_x_bee___i_o64.html#fba12081a914131467ee29f2a615801a" title="the 64-bit (8-byte) address of the sender.">source</a>[i];
<a name="l00816"></a>00816     }
<a name="l00817"></a>00817   }
<a name="l00818"></a>00818   <span class="keywordflow">if</span>( sigstrength )
<a name="l00819"></a>00819     *sigstrength = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#501998ceaa8ed20fff1f6da6ed8f2c52" title="IO 64 packet.">io64</a>.<a class="code" href="struct_x_bee___i_o64.html#62a817e082a8740a7d10deb907e0be19" title="the signal strength of the received message.">rssi</a>;
<a name="l00820"></a>00820   <span class="keywordflow">if</span>( options )
<a name="l00821"></a>00821     *options = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#501998ceaa8ed20fff1f6da6ed8f2c52" title="IO 64 packet.">io64</a>.<a class="code" href="struct_x_bee___i_o64.html#6e8d0ca1203f76a23880a67fcdb346fb" title="bit 1 is Address Broadcast, bit 2 is PAN broadcast.">options</a>;
<a name="l00822"></a>00822   <span class="keywordflow">if</span>( samples )
<a name="l00823"></a>00823   {
<a name="l00824"></a>00824     <span class="keywordflow">if</span>( !XBee_GetIOValues( xbp, samples ) )
<a name="l00825"></a>00825       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00826"></a>00826   }
<a name="l00827"></a>00827   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00828"></a>00828 }
<a name="l00829"></a>00829 <span class="comment"></span>
<a name="l00830"></a>00830 <span class="comment">/** </span>
<a name="l00831"></a>00831 <span class="comment">  Unpack the info from an incoming AT Command Response packet.</span>
<a name="l00832"></a>00832 <span class="comment">  In response to a previous AT Command message, the module will send an AT Command Response message.</span>
<a name="l00833"></a>00833 <span class="comment"></span>
<a name="l00834"></a>00834 <span class="comment">  Pass \b NULL into any of the parameters you don't care about.</span>
<a name="l00835"></a>00835 <span class="comment">  @param xbp The XBeePacket to read from.</span>
<a name="l00836"></a>00836 <span class="comment">  @param frameID A pointer to a uint64 that will be filled up with the 16-bit address of this packet.</span>
<a name="l00837"></a>00837 <span class="comment">  @param command A pointer to a uint8 that will be filled up with the signal strength of this packet.</span>
<a name="l00838"></a>00838 <span class="comment">  @param status A pointer to a uint8 that will be filled up with the XBee options for this packet.</span>
<a name="l00839"></a>00839 <span class="comment">  @param datavalue The value of the requested command.</span>
<a name="l00840"></a>00840 <span class="comment">  @return True on success, false on failure.</span>
<a name="l00841"></a>00841 <span class="comment">  </span>
<a name="l00842"></a>00842 <span class="comment">  \par Example</span>
<a name="l00843"></a>00843 <span class="comment">  \code</span>
<a name="l00844"></a>00844 <span class="comment">  XBeePacket rxPacket;</span>
<a name="l00845"></a>00845 <span class="comment">  if( XBee_GetPacket( &amp;rxPacket, 0 ) )</span>
<a name="l00846"></a>00846 <span class="comment">  {</span>
<a name="l00847"></a>00847 <span class="comment">    uint8 frameID;</span>
<a name="l00848"></a>00848 <span class="comment">    char* command;</span>
<a name="l00849"></a>00849 <span class="comment">    uint8 status;</span>
<a name="l00850"></a>00850 <span class="comment">    int value = -1;</span>
<a name="l00851"></a>00851 <span class="comment">    if( XBee_ReadAtResponsePacket( &amp;rxPacket, &amp;frameID, command, &amp;status, &amp;value ) )</span>
<a name="l00852"></a>00852 <span class="comment">    {</span>
<a name="l00853"></a>00853 <span class="comment">      // then process the new packet here</span>
<a name="l00854"></a>00854 <span class="comment">      XBee_ResetPacket( &amp;rxPacket ); // and clear it out before reading again</span>
<a name="l00855"></a>00855 <span class="comment">    }</span>
<a name="l00856"></a>00856 <span class="comment">  }</span>
<a name="l00857"></a>00857 <span class="comment">  \endcode</span>
<a name="l00858"></a>00858 <span class="comment">*/</span>
<a name="l00859"></a><a class="code" href="group___x_bee.html#gec56fbcf2e08aa68574da35e467b9ec6">00859</a> <span class="keywordtype">bool</span> <a class="code" href="group___x_bee.html#gec56fbcf2e08aa68574da35e467b9ec6" title="Unpack the info from an incoming AT Command Response packet.">XBee_ReadAtResponsePacket</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* xbp, uint8* frameID, <span class="keywordtype">char</span>** command, uint8* status, <span class="keywordtype">int</span>* datavalue )
<a name="l00860"></a>00860 {
<a name="l00861"></a>00861   <span class="keywordflow">if</span>( xbp-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> != <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d84cce6d88f7ded752cb874f687afa5f8a8" title="A response to an AT command query.">XBEE_ATCOMMANDRESPONSE</a> )
<a name="l00862"></a>00862     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00863"></a>00863   <span class="keywordflow">if</span>( frameID )
<a name="l00864"></a>00864     *frameID = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#da85678c7b561e15ea37eae56201be47" title="AT Command Response packet.">atResponse</a>.<a class="code" href="struct_x_bee___a_t_command_response.html#4148da9fddabeadf739d25c04bc83e1f" title="the ID that this response is referring to.">frameID</a>;
<a name="l00865"></a>00865   <span class="keywordflow">if</span>( command )
<a name="l00866"></a>00866     *command = (<span class="keywordtype">char</span>*)xbp-&gt;<a class="code" href="struct_x_bee_packet.html#da85678c7b561e15ea37eae56201be47" title="AT Command Response packet.">atResponse</a>.<a class="code" href="struct_x_bee___a_t_command_response.html#a237f128e023cbecd07ddf1acb934c43" title="the 2-character AT command.">command</a>;
<a name="l00867"></a>00867   <span class="keywordflow">if</span>( status )
<a name="l00868"></a>00868     *status = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#da85678c7b561e15ea37eae56201be47" title="AT Command Response packet.">atResponse</a>.<a class="code" href="struct_x_bee___a_t_command_response.html#d3de4c15b92ae599fbced36655af2763" title="response value - 0 (OK) or 1 (ERROR).">status</a>;
<a name="l00869"></a>00869   <span class="keywordflow">if</span>( datavalue )
<a name="l00870"></a>00870   {
<a name="l00871"></a>00871     uint8 *dataPtr = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#da85678c7b561e15ea37eae56201be47" title="AT Command Response packet.">atResponse</a>.<a class="code" href="struct_x_bee___a_t_command_response.html#d0804b8c185bc6a344398694f7df441b" title="a buffer containing the value of the AT command response.">value</a>;
<a name="l00872"></a>00872     <span class="keywordtype">int</span> i;
<a name="l00873"></a>00873     <span class="keywordtype">int</span> datalength = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#32a7998ec8549ba1daa882f03bc41e49" title="The length of a packet - only useful after a successful call to XBee_GetPacket()...">length</a> - 5; <span class="comment">// data comes after apiID, frameID, 2-bytes of cmd, and 1-byte status</span>
<a name="l00874"></a>00874     *datavalue = 0;
<a name="l00875"></a>00875     <span class="keywordflow">for</span>( i = 0; i &lt; datalength; i++ )
<a name="l00876"></a>00876     {
<a name="l00877"></a>00877       *datavalue &lt;&lt;= 8;
<a name="l00878"></a>00878       *datavalue += *dataPtr++;
<a name="l00879"></a>00879     }
<a name="l00880"></a>00880   }
<a name="l00881"></a>00881   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00882"></a>00882 }
<a name="l00883"></a>00883 <span class="comment"></span>
<a name="l00884"></a>00884 <span class="comment">/** </span>
<a name="l00885"></a>00885 <span class="comment">  Unpack the info from TX Status packet.</span>
<a name="l00886"></a>00886 <span class="comment">  When a TX is completed, the modules esnds a TX Status message.  This indicates whether the packet was transmitted</span>
<a name="l00887"></a>00887 <span class="comment">  successfully or not.  If the message you sent had a frameID of 0, a TX status message will not be generated.</span>
<a name="l00888"></a>00888 <span class="comment"></span>
<a name="l00889"></a>00889 <span class="comment">  Pass \b NULL into any of the parameters you don't care about.</span>
<a name="l00890"></a>00890 <span class="comment">  @param xbp The XBeePacket to read from.</span>
<a name="l00891"></a>00891 <span class="comment">  @param frameID A pointer to a uint8 that will be filled up with the frame ID of this packet.</span>
<a name="l00892"></a>00892 <span class="comment">  @param status A pointer to a uint8 that will be filled up with the status of this packet.</span>
<a name="l00893"></a>00893 <span class="comment">  @return True on success, false on failure.</span>
<a name="l00894"></a>00894 <span class="comment">  </span>
<a name="l00895"></a>00895 <span class="comment">  \par Example</span>
<a name="l00896"></a>00896 <span class="comment">  \code</span>
<a name="l00897"></a>00897 <span class="comment">  XBeePacket rxPacket;</span>
<a name="l00898"></a>00898 <span class="comment">  if( XBee_GetPacket( &amp;rxPacket, 0 ) )</span>
<a name="l00899"></a>00899 <span class="comment">  {</span>
<a name="l00900"></a>00900 <span class="comment">    uint8 frameID;</span>
<a name="l00901"></a>00901 <span class="comment">    uint8 status;</span>
<a name="l00902"></a>00902 <span class="comment">    if( XBee_ReadTXStatusPacket( &amp;rxPacket, &amp;frameID, &amp;status ) )</span>
<a name="l00903"></a>00903 <span class="comment">    {</span>
<a name="l00904"></a>00904 <span class="comment">      // then process the new packet here</span>
<a name="l00905"></a>00905 <span class="comment">      XBee_ResetPacket( &amp;rxPacket ); // and clear it out before reading again</span>
<a name="l00906"></a>00906 <span class="comment">    }</span>
<a name="l00907"></a>00907 <span class="comment">  }</span>
<a name="l00908"></a>00908 <span class="comment">  \endcode</span>
<a name="l00909"></a>00909 <span class="comment">*/</span>
<a name="l00910"></a><a class="code" href="group___x_bee.html#ga9d737273a7ae0ab7240424b058fc639">00910</a> <span class="keywordtype">bool</span> <a class="code" href="group___x_bee.html#ga9d737273a7ae0ab7240424b058fc639" title="Unpack the info from TX Status packet.">XBee_ReadTXStatusPacket</a>( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* xbp, uint8* frameID, uint8* status )
<a name="l00911"></a>00911 {
<a name="l00912"></a>00912   <span class="keywordflow">if</span>( xbp-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> != <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d84df5deb55382d3e65262cedabe6cedd3f" title="TX status packet.">XBEE_TXSTATUS</a> )
<a name="l00913"></a>00913     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00914"></a>00914   <span class="keywordflow">if</span>( frameID )
<a name="l00915"></a>00915     *frameID = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#aa9e76524abbf47f4718081e9183d746" title="TX status packet.">txStatus</a>.<a class="code" href="struct_x_bee___t_x_status.html#d3c75fc63a64118c585f2b9ca7506142" title="the ID that this response is referring to.">frameID</a>;
<a name="l00916"></a>00916   <span class="keywordflow">if</span>( status )
<a name="l00917"></a>00917     *status = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#aa9e76524abbf47f4718081e9183d746" title="TX status packet.">txStatus</a>.<a class="code" href="struct_x_bee___t_x_status.html#317e1b2ecb97f3ef6f51a3f9ed5da53e" title="can have values of:0 - success1 - No ACK received2 - CCA failure3 - Purged.">status</a>;
<a name="l00918"></a>00918   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00919"></a>00919 }
<a name="l00920"></a>00920 <span class="comment"></span>
<a name="l00921"></a>00921 <span class="comment">/** </span>
<a name="l00922"></a>00922 <span class="comment">  Save the configuration changes you've made on the module to memory.</span>
<a name="l00923"></a>00923 <span class="comment">  When you make configuration changes - setting the module to API mode, or configuring the sample rate, for example - </span>
<a name="l00924"></a>00924 <span class="comment">  those changes will be lost when the module restarts.  Call this function to save the current state to non-volatile memory.</span>
<a name="l00925"></a>00925 <span class="comment"></span>
<a name="l00926"></a>00926 <span class="comment">  As with the other \b XBeeConfig functions, make sure you're in API mode before trying to use this function.</span>
<a name="l00927"></a>00927 <span class="comment">  @return True on success, false on failure.</span>
<a name="l00928"></a>00928 <span class="comment">  @see XBeeConfig_SetPacketApiMode( )</span>
<a name="l00929"></a>00929 <span class="comment">  </span>
<a name="l00930"></a>00930 <span class="comment">  \par Example</span>
<a name="l00931"></a>00931 <span class="comment">  \code</span>
<a name="l00932"></a>00932 <span class="comment">  XBeeConfig_SetPacketApiMode( );</span>
<a name="l00933"></a>00933 <span class="comment">  XBeeConfig_SetSampleRate( 100 );</span>
<a name="l00934"></a>00934 <span class="comment">  XBeeConfig_WriteStateToMemory( );</span>
<a name="l00935"></a>00935 <span class="comment">  \endcode</span>
<a name="l00936"></a>00936 <span class="comment">*/</span>
<a name="l00937"></a><a class="code" href="group___x_bee.html#g60564c155b8d6a6e73a9bfa54917ebd2">00937</a> <span class="keywordtype">void</span> <a class="code" href="group___x_bee.html#g60564c155b8d6a6e73a9bfa54917ebd2" title="Save the configuration changes you&amp;#39;ve made on the module to memory.">XBeeConfig_WriteStateToMemory</a>( <span class="keywordtype">void</span> )
<a name="l00938"></a>00938 {
<a name="l00939"></a>00939   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l00940"></a>00940   uint8 params[4];
<a name="l00941"></a>00941   memset( params, 0, 4 );
<a name="l00942"></a>00942   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0, <span class="stringliteral">"WR"</span>, params, 4 );
<a name="l00943"></a>00943   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 4 );
<a name="l00944"></a>00944 }
<a name="l00945"></a>00945 <span class="comment"></span>
<a name="l00946"></a>00946 <span class="comment">/** </span>
<a name="l00947"></a>00947 <span class="comment">  Set this module's address.</span>
<a name="l00948"></a>00948 <span class="comment"></span>
<a name="l00949"></a>00949 <span class="comment">  As with the other \b XBeeConfig functions, make sure you're in API mode before trying to use this function.</span>
<a name="l00950"></a>00950 <span class="comment">  @param address An integer specifying the module's address.</span>
<a name="l00951"></a>00951 <span class="comment">  @return True on success, false on failure.</span>
<a name="l00952"></a>00952 <span class="comment">  @see XBeeConfig_SetPacketApiMode( )</span>
<a name="l00953"></a>00953 <span class="comment">  </span>
<a name="l00954"></a>00954 <span class="comment">  \par Example</span>
<a name="l00955"></a>00955 <span class="comment">  \code</span>
<a name="l00956"></a>00956 <span class="comment">  XBeeConfig_SetPacketApiMode( );</span>
<a name="l00957"></a>00957 <span class="comment">  XBeeConfig_SetAddress( 100 );</span>
<a name="l00958"></a>00958 <span class="comment">  XBeeConfig_WriteStateToMemory( );</span>
<a name="l00959"></a>00959 <span class="comment">  \endcode</span>
<a name="l00960"></a>00960 <span class="comment">*/</span>
<a name="l00961"></a><a class="code" href="group___x_bee.html#gf6eb50d7c632ccadf35d89bebf30ba4a">00961</a> <span class="keywordtype">void</span> <a class="code" href="group___x_bee.html#gf6eb50d7c632ccadf35d89bebf30ba4a" title="Set this module&amp;#39;s address.">XBeeConfig_SetAddress</a>( uint16 address )
<a name="l00962"></a>00962 {
<a name="l00963"></a>00963   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l00964"></a>00964   uint8 params[4]; <span class="comment">// big endian - most significant bit first</span>
<a name="l00965"></a>00965   <a class="code" href="group___x_bee.html#gd357b57c2604013a69ec60e746318f89" title="Convert a 32-bit integer into a big endian array of 4 unsigned 8-bit integers.">XBee_IntToBigEndianArray</a>( address, params );
<a name="l00966"></a>00966   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0, <span class="stringliteral">"MY"</span>, params, 4 );
<a name="l00967"></a>00967   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 4 );
<a name="l00968"></a>00968 }
<a name="l00969"></a>00969 <span class="comment"></span>
<a name="l00970"></a>00970 <span class="comment">/** </span>
<a name="l00971"></a>00971 <span class="comment">  Query the address of the module.</span>
<a name="l00972"></a>00972 <span class="comment">  This will block for up to a 1/2 second waiting for a response from the XBee module.</span>
<a name="l00973"></a>00973 <span class="comment">  @return An integer corresponding to the address of the module, or negative number on failure.</span>
<a name="l00974"></a>00974 <span class="comment">  </span>
<a name="l00975"></a>00975 <span class="comment">  \par Example</span>
<a name="l00976"></a>00976 <span class="comment">  \code</span>
<a name="l00977"></a>00977 <span class="comment">  int address = XBeeConfig_RequestAddress( );</span>
<a name="l00978"></a>00978 <span class="comment">  if( address &gt;= 0 )</span>
<a name="l00979"></a>00979 <span class="comment">  {</span>
<a name="l00980"></a>00980 <span class="comment">    // then we have our address</span>
<a name="l00981"></a>00981 <span class="comment">  }</span>
<a name="l00982"></a>00982 <span class="comment">  \endcode</span>
<a name="l00983"></a>00983 <span class="comment">*/</span>
<a name="l00984"></a><a class="code" href="group___x_bee.html#gcca92909fdf6d844af5da5a13b1d1303">00984</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#gcca92909fdf6d844af5da5a13b1d1303" title="Query the address of the module.">XBeeConfig_RequestAddress</a>( )
<a name="l00985"></a>00985 {
<a name="l00986"></a>00986   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l00987"></a>00987   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0x52, <span class="stringliteral">"MY"</span>, NULL, 0 );
<a name="l00988"></a>00988   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 0 );
<a name="l00989"></a>00989   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l00990"></a>00990 }
<a name="l00991"></a>00991 <span class="comment"></span>
<a name="l00992"></a>00992 <span class="comment">/** </span>
<a name="l00993"></a>00993 <span class="comment">  Set this PAN (Personal Area Network) ID.</span>
<a name="l00994"></a>00994 <span class="comment">  Only modules with matching PAN IDs can communicate with each other.  Unique PAN IDs enable control of which</span>
<a name="l00995"></a>00995 <span class="comment">  RF packets are received by a module.  Default is \b 0x3332.</span>
<a name="l00996"></a>00996 <span class="comment"></span>
<a name="l00997"></a>00997 <span class="comment">  As with the other \b XBeeConfig functions, make sure you're in API mode before trying to use this function.</span>
<a name="l00998"></a>00998 <span class="comment">  @param id A uint16 specifying the PAN ID.</span>
<a name="l00999"></a>00999 <span class="comment">  @return True on success, false on failure.</span>
<a name="l01000"></a>01000 <span class="comment">  @see XBeeConfig_SetPacketApiMode( )</span>
<a name="l01001"></a>01001 <span class="comment">  </span>
<a name="l01002"></a>01002 <span class="comment">  \par Example</span>
<a name="l01003"></a>01003 <span class="comment">  \code</span>
<a name="l01004"></a>01004 <span class="comment">  XBeeConfig_SetPacketApiMode( );</span>
<a name="l01005"></a>01005 <span class="comment">  XBeeConfig_SetPanID( 0x1234 );</span>
<a name="l01006"></a>01006 <span class="comment">  \endcode</span>
<a name="l01007"></a>01007 <span class="comment">*/</span>
<a name="l01008"></a><a class="code" href="group___x_bee.html#gbb8511090eee4d72a26bf55fb44bcd68">01008</a> <span class="keywordtype">void</span> <a class="code" href="group___x_bee.html#gbb8511090eee4d72a26bf55fb44bcd68" title="Set this PAN (Personal Area Network) ID.">XBeeConfig_SetPanID</a>( uint16 <span class="keywordtype">id</span> )
<a name="l01009"></a>01009 {
<a name="l01010"></a>01010   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01011"></a>01011   uint8 params[4]; <span class="comment">// big endian - most significant bit first</span>
<a name="l01012"></a>01012   <a class="code" href="group___x_bee.html#gd357b57c2604013a69ec60e746318f89" title="Convert a 32-bit integer into a big endian array of 4 unsigned 8-bit integers.">XBee_IntToBigEndianArray</a>( <span class="keywordtype">id</span>, params );
<a name="l01013"></a>01013   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0, <span class="stringliteral">"ID"</span>, params, 4 );
<a name="l01014"></a>01014   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 4 );
<a name="l01015"></a>01015 }
<a name="l01016"></a>01016 <span class="comment"></span>
<a name="l01017"></a>01017 <span class="comment">/** </span>
<a name="l01018"></a>01018 <span class="comment">  Query the PAN ID of the module.</span>
<a name="l01019"></a>01019 <span class="comment">  This will block for up to a 1/2 second waiting for a response from the XBee module.</span>
<a name="l01020"></a>01020 <span class="comment">  @return An integer corresponding to the PAN ID of the module, or negative number on failure.</span>
<a name="l01021"></a>01021 <span class="comment">  </span>
<a name="l01022"></a>01022 <span class="comment">  \par Example</span>
<a name="l01023"></a>01023 <span class="comment">  \code</span>
<a name="l01024"></a>01024 <span class="comment">  int panid = XBeeConfig_RequestPanID( );</span>
<a name="l01025"></a>01025 <span class="comment">  if( panid &gt;= 0 )</span>
<a name="l01026"></a>01026 <span class="comment">  {</span>
<a name="l01027"></a>01027 <span class="comment">    // then we have our pan id</span>
<a name="l01028"></a>01028 <span class="comment">  }</span>
<a name="l01029"></a>01029 <span class="comment">  \endcode</span>
<a name="l01030"></a>01030 <span class="comment">*/</span>
<a name="l01031"></a><a class="code" href="group___x_bee.html#gd24a98ab72e3e7767982e59ba663c003">01031</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#gd24a98ab72e3e7767982e59ba663c003" title="Query the PAN ID of the module.">XBeeConfig_RequestPanID</a>( )
<a name="l01032"></a>01032 {
<a name="l01033"></a>01033   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01034"></a>01034   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0x52, <span class="stringliteral">"ID"</span>, NULL, 0 );
<a name="l01035"></a>01035   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 0 );
<a name="l01036"></a>01036   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l01037"></a>01037 }
<a name="l01038"></a>01038 <span class="comment"></span>
<a name="l01039"></a>01039 <span class="comment">/** </span>
<a name="l01040"></a>01040 <span class="comment">  Set the module's channel.</span>
<a name="l01041"></a>01041 <span class="comment">  The channel is one of 3 addressing options available to the module - the others are the PAN ID and the</span>
<a name="l01042"></a>01042 <span class="comment">  destination address.  In order for modules to communicate with each other, the modules must share the same</span>
<a name="l01043"></a>01043 <span class="comment">  channel number.  Default is \b 0x0C.</span>
<a name="l01044"></a>01044 <span class="comment"></span>
<a name="l01045"></a>01045 <span class="comment">  This value can have the range \b 0x0B - \b 0x1A for XBee modules, and \b 0x0C - \b 0x17 for XBee-Pro modules.</span>
<a name="l01046"></a>01046 <span class="comment"></span>
<a name="l01047"></a>01047 <span class="comment">  As with the other \b XBeeConfig functions, make sure you're in API mode before trying to use this function.</span>
<a name="l01048"></a>01048 <span class="comment">  @param channel A uint8 specifying the channel.</span>
<a name="l01049"></a>01049 <span class="comment">  @return True on success, false on failure.</span>
<a name="l01050"></a>01050 <span class="comment">  @see XBeeConfig_SetPacketApiMode( )</span>
<a name="l01051"></a>01051 <span class="comment">  </span>
<a name="l01052"></a>01052 <span class="comment">  \par Example</span>
<a name="l01053"></a>01053 <span class="comment">  \code</span>
<a name="l01054"></a>01054 <span class="comment">  XBeeConfig_SetPacketApiMode( );</span>
<a name="l01055"></a>01055 <span class="comment">  XBeeConfig_SetChannel( 0x0D );</span>
<a name="l01056"></a>01056 <span class="comment">  \endcode</span>
<a name="l01057"></a>01057 <span class="comment">*/</span>
<a name="l01058"></a><a class="code" href="group___x_bee.html#gd5fd4ac5a68e76d7a16b3e685f05a4f8">01058</a> <span class="keywordtype">void</span> <a class="code" href="group___x_bee.html#gd5fd4ac5a68e76d7a16b3e685f05a4f8" title="Set the module&amp;#39;s channel.">XBeeConfig_SetChannel</a>( uint8 channel )
<a name="l01059"></a>01059 {
<a name="l01060"></a>01060   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01061"></a>01061   uint8 params[4];
<a name="l01062"></a>01062   <a class="code" href="group___x_bee.html#gd357b57c2604013a69ec60e746318f89" title="Convert a 32-bit integer into a big endian array of 4 unsigned 8-bit integers.">XBee_IntToBigEndianArray</a>( channel, params );
<a name="l01063"></a>01063   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0, <span class="stringliteral">"CH"</span>, params, 4 );
<a name="l01064"></a>01064   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 4 );
<a name="l01065"></a>01065 }
<a name="l01066"></a>01066 <span class="comment"></span>
<a name="l01067"></a>01067 <span class="comment">/** </span>
<a name="l01068"></a>01068 <span class="comment">  Query the channel of the module.</span>
<a name="l01069"></a>01069 <span class="comment">  This will block for up to a 1/2 second waiting for a response from the XBee module.</span>
<a name="l01070"></a>01070 <span class="comment">  @return An integer corresponding to the channel of the module, or negative number on failure.</span>
<a name="l01071"></a>01071 <span class="comment">  </span>
<a name="l01072"></a>01072 <span class="comment">  \par Example</span>
<a name="l01073"></a>01073 <span class="comment">  \code</span>
<a name="l01074"></a>01074 <span class="comment">  int chan = XBeeConfig_RequestChannel( );</span>
<a name="l01075"></a>01075 <span class="comment">  if( chan &gt;= 0 )</span>
<a name="l01076"></a>01076 <span class="comment">  {</span>
<a name="l01077"></a>01077 <span class="comment">    // then we have our channel</span>
<a name="l01078"></a>01078 <span class="comment">  }</span>
<a name="l01079"></a>01079 <span class="comment">  \endcode</span>
<a name="l01080"></a>01080 <span class="comment">*/</span>
<a name="l01081"></a><a class="code" href="group___x_bee.html#ga893d7c545c7b39c0f6909be757751fd">01081</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#ga893d7c545c7b39c0f6909be757751fd" title="Query the channel of the module.">XBeeConfig_RequestChannel</a>( )
<a name="l01082"></a>01082 {
<a name="l01083"></a>01083   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01084"></a>01084   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0x52, <span class="stringliteral">"CH"</span>, NULL, 0 );
<a name="l01085"></a>01085   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 0 );
<a name="l01086"></a>01086   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l01087"></a>01087 }
<a name="l01088"></a>01088 <span class="comment"></span>
<a name="l01089"></a>01089 <span class="comment">/** </span>
<a name="l01090"></a>01090 <span class="comment">  Set the rate at which the module will sample its IO pins.</span>
<a name="l01091"></a>01091 <span class="comment">  When the sample rate is set, the module will sample all its IO pins according to its current IO configuration and send</span>
<a name="l01092"></a>01092 <span class="comment">  a packet with the sample data.  If this is set too low and the IO configuration is sampling too many channels, </span>
<a name="l01093"></a>01093 <span class="comment">  the RF module won't be able to keep up.  You can also adjust how many samples are gathered before a packet is sent.</span>
<a name="l01094"></a>01094 <span class="comment"></span>
<a name="l01095"></a>01095 <span class="comment">  As with the other \b XBeeConfig functions, make sure you're in API mode before trying to use this function.</span>
<a name="l01096"></a>01096 <span class="comment">  @param rate A uint16 specifying the sample rate in milliseconds.</span>
<a name="l01097"></a>01097 <span class="comment">  @return True on success, false on failure.</span>
<a name="l01098"></a>01098 <span class="comment">  @see XBeeConfig_SetIOs( ), XBeeConfig_SetPacketApiMode( )</span>
<a name="l01099"></a>01099 <span class="comment">  </span>
<a name="l01100"></a>01100 <span class="comment">  \par Example</span>
<a name="l01101"></a>01101 <span class="comment">  \code</span>
<a name="l01102"></a>01102 <span class="comment">  XBeeConfig_SetPacketApiMode( );</span>
<a name="l01103"></a>01103 <span class="comment">  XBeeConfig_SetSampleRate( 0x14 );</span>
<a name="l01104"></a>01104 <span class="comment">  \endcode</span>
<a name="l01105"></a>01105 <span class="comment">*/</span>
<a name="l01106"></a><a class="code" href="group___x_bee.html#g35826df514efda2aab33f86cf0e24f2e">01106</a> <span class="keywordtype">void</span> <a class="code" href="group___x_bee.html#g35826df514efda2aab33f86cf0e24f2e" title="Set the rate at which the module will sample its IO pins.">XBeeConfig_SetSampleRate</a>( uint16 rate )
<a name="l01107"></a>01107 {
<a name="l01108"></a>01108   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01109"></a>01109   uint8 params[4]; <span class="comment">// big endian - most significant bit first</span>
<a name="l01110"></a>01110   <a class="code" href="group___x_bee.html#gd357b57c2604013a69ec60e746318f89" title="Convert a 32-bit integer into a big endian array of 4 unsigned 8-bit integers.">XBee_IntToBigEndianArray</a>( rate, params );
<a name="l01111"></a>01111   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0, <span class="stringliteral">"IR"</span>, params, 4 );
<a name="l01112"></a>01112   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 4 );
<a name="l01113"></a>01113 }
<a name="l01114"></a>01114 <span class="comment"></span>
<a name="l01115"></a>01115 <span class="comment">/** </span>
<a name="l01116"></a>01116 <span class="comment">  Query the sample rate of the module.</span>
<a name="l01117"></a>01117 <span class="comment">  This will block for up to a 1/2 second waiting for a response from the XBee module.</span>
<a name="l01118"></a>01118 <span class="comment">  @return An integer corresponding to the sample rate of the module, or negative number on failure.</span>
<a name="l01119"></a>01119 <span class="comment">  </span>
<a name="l01120"></a>01120 <span class="comment">  \par Example</span>
<a name="l01121"></a>01121 <span class="comment">  \code</span>
<a name="l01122"></a>01122 <span class="comment">  int rate = XBeeConfig_RequestSampleRate( );</span>
<a name="l01123"></a>01123 <span class="comment">  if( rate &gt;= 0 )</span>
<a name="l01124"></a>01124 <span class="comment">  {</span>
<a name="l01125"></a>01125 <span class="comment">    // then we have our rate</span>
<a name="l01126"></a>01126 <span class="comment">  }</span>
<a name="l01127"></a>01127 <span class="comment">  \endcode</span>
<a name="l01128"></a>01128 <span class="comment">*/</span>
<a name="l01129"></a><a class="code" href="group___x_bee.html#g00ce3bb898806b5cf6bb257dfb24ca9c">01129</a> <span class="keywordtype">int</span> <a class="code" href="group___x_bee.html#g00ce3bb898806b5cf6bb257dfb24ca9c" title="Query the sample rate of the module.">XBeeConfig_RequestSampleRate</a>( )
<a name="l01130"></a>01130 {
<a name="l01131"></a>01131   <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01132"></a>01132   <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0x52, <span class="stringliteral">"IR"</span>, NULL, 0 );
<a name="l01133"></a>01133   <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 0 );
<a name="l01134"></a>01134   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l01135"></a>01135 }
<a name="l01136"></a>01136 <span class="comment"></span>
<a name="l01137"></a>01137 <span class="comment">/** </span>
<a name="l01138"></a>01138 <span class="comment">  Convert a 32-bit integer into a big endian array of 4 unsigned 8-bit integers.</span>
<a name="l01139"></a>01139 <span class="comment">  This is mostly useful for sending AT Command packets.</span>
<a name="l01140"></a>01140 <span class="comment">  @param value The value to convert.</span>
<a name="l01141"></a>01141 <span class="comment">  @param array An array of 4 unsigned 8-bit integers (uint8).  Be sure you have 4.</span>
<a name="l01142"></a>01142 <span class="comment">  \par Example</span>
<a name="l01143"></a>01143 <span class="comment">  see XBee_CreateATCommandPacket( ) for an example.</span>
<a name="l01144"></a>01144 <span class="comment">*/</span>
<a name="l01145"></a><a class="code" href="group___x_bee.html#gd357b57c2604013a69ec60e746318f89">01145</a> <span class="keywordtype">void</span> <a class="code" href="group___x_bee.html#gd357b57c2604013a69ec60e746318f89" title="Convert a 32-bit integer into a big endian array of 4 unsigned 8-bit integers.">XBee_IntToBigEndianArray</a>( <span class="keywordtype">int</span> value, uint8* array )
<a name="l01146"></a>01146 {
<a name="l01147"></a>01147   array[0] = (value &gt;&gt; 24) &amp; 0xFF;
<a name="l01148"></a>01148   array[1] = (value &gt;&gt; 16) &amp; 0xFF;
<a name="l01149"></a>01149   array[2] = (value &gt;&gt; 8) &amp; 0xFF;
<a name="l01150"></a>01150   array[3] = value &amp; 0xFF;
<a name="l01151"></a>01151 }
<a name="l01152"></a>01152 <span class="comment"></span>
<a name="l01153"></a>01153 <span class="comment">/** @}</span>
<a name="l01154"></a>01154 <span class="comment">*/</span>
<a name="l01155"></a>01155 <span class="comment"></span>
<a name="l01156"></a>01156 <span class="comment">/** </span>
<a name="l01157"></a>01157 <span class="comment">  Unpack IO values from an incoming packet.</span>
<a name="l01158"></a>01158 <span class="comment">  @param packet The XBeePacket to read from.</span>
<a name="l01159"></a>01159 <span class="comment">  @param inputs An array of at least 9 integers, which will be populated with the values of the 9 input lines on the XBee module.</span>
<a name="l01160"></a>01160 <span class="comment">  @return 1 if IO values were successfully retrieved, otherwise zero.</span>
<a name="l01161"></a>01161 <span class="comment">  </span>
<a name="l01162"></a>01162 <span class="comment">  \par Example</span>
<a name="l01163"></a>01163 <span class="comment">  \code</span>
<a name="l01164"></a>01164 <span class="comment">  XBeePacket rxPacket;</span>
<a name="l01165"></a>01165 <span class="comment">  if( XBee_GetPacket( &amp;rxPacket, 0 ) )</span>
<a name="l01166"></a>01166 <span class="comment">  {</span>
<a name="l01167"></a>01167 <span class="comment">    int inputs[9];</span>
<a name="l01168"></a>01168 <span class="comment">    if( XBee_GetIOValues( &amp;rxPacket, inputs ) )</span>
<a name="l01169"></a>01169 <span class="comment">    {</span>
<a name="l01170"></a>01170 <span class="comment">      // process new input values here</span>
<a name="l01171"></a>01171 <span class="comment">    }</span>
<a name="l01172"></a>01172 <span class="comment">  }</span>
<a name="l01173"></a>01173 <span class="comment">  \endcode</span>
<a name="l01174"></a>01174 <span class="comment">*/</span>
<a name="l01175"></a>01175 <span class="keyword">static</span> <span class="keywordtype">bool</span> XBee_GetIOValues( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* packet, <span class="keywordtype">int</span> *inputs )
<a name="l01176"></a>01176 {
<a name="l01177"></a>01177   <span class="keywordflow">if</span>( packet-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> == <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d84ab62c1657ee730b996f8ae23316ab0f2" title="An incoming IO packet with a 16-bit address.">XBEE_IO16</a> || packet-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> == <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d840cf36c28801085928d7c003a59343751" title="An incoming IO packet with a 64-bit address.">XBEE_IO64</a> )
<a name="l01178"></a>01178   {
<a name="l01179"></a>01179     <span class="keywordtype">int</span> i;
<a name="l01180"></a>01180     <span class="keyword">static</span> <span class="keywordtype">bool</span> enabled;
<a name="l01181"></a>01181     <span class="keywordtype">int</span> digitalins = 0;
<a name="l01182"></a>01182     uint8* p;
<a name="l01183"></a>01183     <span class="keywordtype">int</span> channelIndicators;
<a name="l01184"></a>01184     <span class="keywordflow">if</span>( packet-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> == <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d84ab62c1657ee730b996f8ae23316ab0f2" title="An incoming IO packet with a 16-bit address.">XBEE_IO16</a> )
<a name="l01185"></a>01185     {
<a name="l01186"></a>01186       p = packet-&gt;<a class="code" href="struct_x_bee_packet.html#a7c7b72615863bf0558891e77ec05a09" title="IO 16 packet.">io16</a>.<a class="code" href="struct_x_bee___i_o16.html#8d91df5f6d281f8f1115370172339521" title="a buffer containing the IO values as indicated by channelIndicators.">data</a>;
<a name="l01187"></a>01187       channelIndicators = (packet-&gt;<a class="code" href="struct_x_bee_packet.html#a7c7b72615863bf0558891e77ec05a09" title="IO 16 packet.">io16</a>.<a class="code" href="struct_x_bee___i_o16.html#b23393e8393d8ad02f8450427ec6bbd2" title="a bit mask indicating which channels have been sampled.">channelIndicators</a>[0] &lt;&lt; 0x08) | packet-&gt;<a class="code" href="struct_x_bee_packet.html#a7c7b72615863bf0558891e77ec05a09" title="IO 16 packet.">io16</a>.<a class="code" href="struct_x_bee___i_o16.html#b23393e8393d8ad02f8450427ec6bbd2" title="a bit mask indicating which channels have been sampled.">channelIndicators</a>[1];
<a name="l01188"></a>01188     }
<a name="l01189"></a>01189     <span class="keywordflow">else</span> <span class="comment">// packet-&gt;apiId == XBEE_IO64</span>
<a name="l01190"></a>01190     {
<a name="l01191"></a>01191       p = packet-&gt;<a class="code" href="struct_x_bee_packet.html#501998ceaa8ed20fff1f6da6ed8f2c52" title="IO 64 packet.">io64</a>.<a class="code" href="struct_x_bee___i_o64.html#b65f5330699b31e2cdc6d2f5044b7f5c" title="a buffer containing the IO values as indicated by channelIndicators.">data</a>;
<a name="l01192"></a>01192       channelIndicators = (packet-&gt;<a class="code" href="struct_x_bee_packet.html#501998ceaa8ed20fff1f6da6ed8f2c52" title="IO 64 packet.">io64</a>.<a class="code" href="struct_x_bee___i_o64.html#027d843fff329ccb929b9c4318d0ad45" title="bit mask indicating which channels have been sampled.">channelIndicators</a>[0] &lt;&lt; 0x08) | packet-&gt;<a class="code" href="struct_x_bee_packet.html#501998ceaa8ed20fff1f6da6ed8f2c52" title="IO 64 packet.">io64</a>.<a class="code" href="struct_x_bee___i_o64.html#027d843fff329ccb929b9c4318d0ad45" title="bit mask indicating which channels have been sampled.">channelIndicators</a>[1];
<a name="l01193"></a>01193     }
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="keywordflow">for</span>( i = 0; i &lt; XBEE_INPUTS; i++ )
<a name="l01196"></a>01196     {
<a name="l01197"></a>01197       enabled = channelIndicators &amp; 1;
<a name="l01198"></a>01198       channelIndicators &gt;&gt;= 1;
<a name="l01199"></a>01199       <span class="keywordflow">if</span>( i &lt; 9 ) <span class="comment">// digital ins</span>
<a name="l01200"></a>01200       {
<a name="l01201"></a>01201         inputs[i] = 0; <span class="comment">// zero out the 9 inputs beforehand</span>
<a name="l01202"></a>01202         <span class="keywordflow">if</span>( enabled )
<a name="l01203"></a>01203         {
<a name="l01204"></a>01204           <span class="keywordflow">if</span>( !digitalins )
<a name="l01205"></a>01205           {
<a name="l01206"></a>01206             <span class="keywordtype">int</span> dig0 = *p++ &lt;&lt; 0x08;
<a name="l01207"></a>01207             digitalins = dig0 | *p++;
<a name="l01208"></a>01208           }
<a name="l01209"></a>01209           inputs[i] = ((digitalins &gt;&gt; i) &amp; 1) * 1023;
<a name="l01210"></a>01210         }
<a name="l01211"></a>01211       }
<a name="l01212"></a>01212       <span class="keywordflow">else</span> <span class="comment">// analog ins</span>
<a name="l01213"></a>01213       {
<a name="l01214"></a>01214         <span class="keywordflow">if</span>( enabled )
<a name="l01215"></a>01215         {
<a name="l01216"></a>01216           <span class="keywordtype">int</span> ain_msb = *p++ &lt;&lt; 0x08;
<a name="l01217"></a>01217           inputs[i-9] = ain_msb | *p++;
<a name="l01218"></a>01218         }
<a name="l01219"></a>01219       }
<a name="l01220"></a>01220     }
<a name="l01221"></a>01221     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01222"></a>01222   }
<a name="l01223"></a>01223   <span class="keywordflow">else</span>
<a name="l01224"></a>01224     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01225"></a>01225 }
<a name="l01226"></a>01226 
<a name="l01227"></a>01227 <span class="preprocessor">#ifdef OSC</span>
<a name="l01228"></a>01228 <span class="preprocessor"></span><span class="preprocessor">#include "osc.h"</span>
<a name="l01229"></a>01229 <span class="comment"></span>
<a name="l01230"></a>01230 <span class="comment">/** \defgroup XBeeOSC XBee - OSC</span>
<a name="l01231"></a>01231 <span class="comment">  Communicate with XBee modules with the Make Controller Kit via OSC.</span>
<a name="l01232"></a>01232 <span class="comment">  \ingroup OSC</span>
<a name="l01233"></a>01233 <span class="comment">  </span>
<a name="l01234"></a>01234 <span class="comment">  \section devices Devices</span>
<a name="l01235"></a>01235 <span class="comment">  There can only be one XBee board connected to the Make Controller Kit's serial port at a time,</span>
<a name="l01236"></a>01236 <span class="comment">  so there is not a device index in XBee OSC messages.</span>
<a name="l01237"></a>01237 <span class="comment">  </span>
<a name="l01238"></a>01238 <span class="comment">  \section properties Properties</span>
<a name="l01239"></a>01239 <span class="comment">  The XBee system has the following properties:</span>
<a name="l01240"></a>01240 <span class="comment">  - autosend</span>
<a name="l01241"></a>01241 <span class="comment">  - io16</span>
<a name="l01242"></a>01242 <span class="comment">  - io64</span>
<a name="l01243"></a>01243 <span class="comment">  - rx16</span>
<a name="l01244"></a>01244 <span class="comment">  - rx64</span>
<a name="l01245"></a>01245 <span class="comment">  - tx16</span>
<a name="l01246"></a>01246 <span class="comment">  - tx64</span>
<a name="l01247"></a>01247 <span class="comment">  - tx-status</span>
<a name="l01248"></a>01248 <span class="comment">  - active</span>
<a name="l01249"></a>01249 <span class="comment">  </span>
<a name="l01250"></a>01250 <span class="comment">  \par Autosend</span>
<a name="l01251"></a>01251 <span class="comment">  The \b autosend property corresponds to whether the Make Controller will automatically send out </span>
<a name="l01252"></a>01252 <span class="comment">  messages it receives from a connected XBee module.  By default, this is turned off.</span>
<a name="l01253"></a>01253 <span class="comment">  To turn this on, send the message</span>
<a name="l01254"></a>01254 <span class="comment">  \verbatim /xbee/autosend 1 \endverbatim</span>
<a name="l01255"></a>01255 <span class="comment">  and to turn it off, send</span>
<a name="l01256"></a>01256 <span class="comment">  \verbatim /xbee/autosend 0 \endverbatim</span>
<a name="l01257"></a>01257 <span class="comment">  All autosend messages send at the same interval.  You can set this interval, in </span>
<a name="l01258"></a>01258 <span class="comment">  milliseconds, by sending the message</span>
<a name="l01259"></a>01259 <span class="comment">  \verbatim /system/autosend-interval 10 \endverbatim</span>
<a name="l01260"></a>01260 <span class="comment">  so that messages will be sent every 10 milliseconds.  This can be anywhere from 1 to 5000 milliseconds.</span>
<a name="l01261"></a>01261 <span class="comment">  \par</span>
<a name="l01262"></a>01262 <span class="comment">  You also need to select whether the board should send to you over USB or Ethernet.  Send</span>
<a name="l01263"></a>01263 <span class="comment">  \verbatim /system/autosend-usb 1 \endverbatim</span>
<a name="l01264"></a>01264 <span class="comment">  to send via USB, and </span>
<a name="l01265"></a>01265 <span class="comment">  \verbatim /system/autosend-udp 1 \endverbatim</span>
<a name="l01266"></a>01266 <span class="comment">  to send via Ethernet.  Via Ethernet, the board will send messages to the last address it received a message from.</span>
<a name="l01267"></a>01267 <span class="comment">  </span>
<a name="l01268"></a>01268 <span class="comment">  \par io16</span>
<a name="l01269"></a>01269 <span class="comment">  The \b io16 property corresponds to an incoming message from an XBee module with samples</span>
<a name="l01270"></a>01270 <span class="comment">  from its IO pins.  The best way to use this is to turn the XBee system's autosend property</span>
<a name="l01271"></a>01271 <span class="comment">  on - then the Make Controller can relay io16 messages as soon as they're received.</span>
<a name="l01272"></a>01272 <span class="comment">  \par</span>
<a name="l01273"></a>01273 <span class="comment">  Once you've turned on autosend, if there are boards on your network that are sending IO packets, </span>
<a name="l01274"></a>01274 <span class="comment">  you'll receive messages like</span>
<a name="l01275"></a>01275 <span class="comment">  \verbatim /xbee/io16 1234 28 12 0 0 1023 1023 0 512 0 1023 \endverbatim</span>
<a name="l01276"></a>01276 <span class="comment">  The first two numbers are:</span>
<a name="l01277"></a>01277 <span class="comment">  -# the address of the module that sent the message (1234 in the example above)</span>
<a name="l01278"></a>01278 <span class="comment">  -# signal strength (28 above) </span>
<a name="l01279"></a>01279 <span class="comment">  \par</span>
<a name="l01280"></a>01280 <span class="comment">  The next 9 numbers are the values from the 9 IO pins on the XBee module.</span>
<a name="l01281"></a>01281 <span class="comment">  </span>
<a name="l01282"></a>01282 <span class="comment">  \par io64</span>
<a name="l01283"></a>01283 <span class="comment">  The \b io64 property corresponds to an incoming message from an XBee module with samples from its IO</span>
<a name="l01284"></a>01284 <span class="comment">  pins.  This message is just like the \b io16 message, except it's coming from a board with a 64-bit</span>
<a name="l01285"></a>01285 <span class="comment">  address, rather than a 16-bit address.  The structure of the message is the same (see above).</span>
<a name="l01286"></a>01286 <span class="comment">  </span>
<a name="l01287"></a>01287 <span class="comment">  \par rx16</span>
<a name="l01288"></a>01288 <span class="comment">  The \b rx16 property corresponds to an incoming message from a 16-bit address XBee module with arbitrary data.  </span>
<a name="l01289"></a>01289 <span class="comment">  The best way to use this is to turn the XBee system's autosend property</span>
<a name="l01290"></a>01290 <span class="comment">  on - then the Make Controller can relay rx16 messages as soon as they're received.</span>
<a name="l01291"></a>01291 <span class="comment">  \par</span>
<a name="l01292"></a>01292 <span class="comment">  Once you've turned on autosend, if there are boards on your network that are sending IO packets, </span>
<a name="l01293"></a>01293 <span class="comment">  you'll receive messages like</span>
<a name="l01294"></a>01294 <span class="comment">  \verbatim /xbee/rx16 1234 28 0 [43 44 45 32 46 47 48] \endverbatim</span>
<a name="l01295"></a>01295 <span class="comment">  The first three numbers are:</span>
<a name="l01296"></a>01296 <span class="comment">  -# the address of the module that sent the message (1234 in the example above)</span>
<a name="l01297"></a>01297 <span class="comment">  -# signal strength (28 above)</span>
<a name="l01298"></a>01298 <span class="comment">  -# the options byte (0 above), respectively. </span>
<a name="l01299"></a>01299 <span class="comment">  \par</span>
<a name="l01300"></a>01300 <span class="comment">  Following those is an OSC blob with the data (enclosed in square brackets above).  These are the hex values for each byte of data.</span>
<a name="l01301"></a>01301 <span class="comment">  </span>
<a name="l01302"></a>01302 <span class="comment">  \par rx64</span>
<a name="l01303"></a>01303 <span class="comment">  The \b rx64 property corresponds to an incoming message from an XBee module with samples from its IO</span>
<a name="l01304"></a>01304 <span class="comment">  pins.  This message is just like the \b io16 message, except it's coming from a board with a 64-bit</span>
<a name="l01305"></a>01305 <span class="comment">  address, rather than a 16-bit address.  The structure of the message is the same (see above).</span>
<a name="l01306"></a>01306 <span class="comment"></span>
<a name="l01307"></a>01307 <span class="comment">  \par Transmit Status</span>
<a name="l01308"></a>01308 <span class="comment">  The \b tx-status property gives you the status of a previously sent message.  It tells you the frameID of the message</span>
<a name="l01309"></a>01309 <span class="comment">  that was sent and its status, which can be one of:</span>
<a name="l01310"></a>01310 <span class="comment">  - \b Success.  Message was successfully transmitted and received.</span>
<a name="l01311"></a>01311 <span class="comment">  - &lt;b&gt; No acknowledgement received&lt;/b&gt;.  The message was successfully sent, but not successfully received on the other end.</span>
<a name="l01312"></a>01312 <span class="comment">  - &lt;b&gt; CCA Failure&lt;/b&gt;.</span>
<a name="l01313"></a>01313 <span class="comment">  - \b Purged.</span>
<a name="l01314"></a>01314 <span class="comment">  \par</span>
<a name="l01315"></a>01315 <span class="comment">  If you don't include a frameID for the message that you sent, a tx-status message will not be generated.  An example</span>
<a name="l01316"></a>01316 <span class="comment">  tx-status message will look like</span>
<a name="l01317"></a>01317 <span class="comment">  \verbatim /xbee/tx-status 52 Success \endverbatim</span>
<a name="l01318"></a>01318 <span class="comment">  where 52 is the frameID and "Success" is the status.</span>
<a name="l01319"></a>01319 <span class="comment">  </span>
<a name="l01320"></a>01320 <span class="comment">  \par Active</span>
<a name="l01321"></a>01321 <span class="comment">  The \b active property corresponds to the active state of the XBee system.</span>
<a name="l01322"></a>01322 <span class="comment">  If you're not seeing appropriate responses to your messages to the XBee system, </span>
<a name="l01323"></a>01323 <span class="comment">  check whether it's active by sending the message</span>
<a name="l01324"></a>01324 <span class="comment">  \verbatim /xbee/active \endverbatim</span>
<a name="l01325"></a>01325 <span class="comment">  \par</span>
<a name="l01326"></a>01326 <span class="comment">  You can set the active flag by sending</span>
<a name="l01327"></a>01327 <span class="comment">  \verbatim /xbee/active 1 \endverbatim</span>
<a name="l01328"></a>01328 <span class="comment">*/</span>
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 
<a name="l01331"></a>01331 <span class="keywordtype">bool</span> XBee_GetAutoSend( <span class="keywordtype">bool</span> init )
<a name="l01332"></a>01332 {
<a name="l01333"></a>01333   <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( 1 );
<a name="l01334"></a>01334   <span class="keywordflow">if</span>( init )
<a name="l01335"></a>01335   {
<a name="l01336"></a>01336     <span class="keywordtype">int</span> autosend;
<a name="l01337"></a>01337     <a class="code" href="group___eeprom.html#g95bd921a774026d4cc96b20d6a20d9dd" title="Read data from the EEPROM.">Eeprom_Read</a>( EEPROM_XBEE_AUTOSEND, (uchar*)&amp;autosend, 4 );
<a name="l01338"></a>01338     XBee-&gt;autosend = (autosend == 1 ) ? 1 : 0;
<a name="l01339"></a>01339   }
<a name="l01340"></a>01340   <span class="keywordflow">return</span> XBee-&gt;autosend;
<a name="l01341"></a>01341 }
<a name="l01342"></a>01342 
<a name="l01343"></a>01343 <span class="keywordtype">void</span> XBee_SetAutoSend( <span class="keywordtype">int</span> onoff )
<a name="l01344"></a>01344 {
<a name="l01345"></a>01345   <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( 1 );  
<a name="l01346"></a>01346   <span class="keywordflow">if</span>( XBee-&gt;autosend != onoff )
<a name="l01347"></a>01347   {
<a name="l01348"></a>01348     XBee-&gt;autosend = onoff;
<a name="l01349"></a>01349     <a class="code" href="group___eeprom.html#g03d8b089bb0d04209e032ea233218d3a" title="Write data to the EEPROM.">Eeprom_Write</a>( EEPROM_XBEE_AUTOSEND, (uchar*)&amp;onoff, 4 );
<a name="l01350"></a>01350   }
<a name="l01351"></a>01351 }
<a name="l01352"></a>01352 
<a name="l01353"></a>01353 <span class="keyword">static</span> <span class="keywordtype">char</span>* XBeeOsc_Name = <span class="stringliteral">"xbee"</span>;
<a name="l01354"></a>01354 <span class="keyword">static</span> <span class="keywordtype">char</span>* XBeeOsc_PropertyNames[] = { <span class="stringliteral">"active"</span>, <span class="stringliteral">"io16"</span>, <span class="stringliteral">"rx16"</span>, <span class="stringliteral">"autosend"</span>, <span class="stringliteral">"get-message"</span>, 0 }; <span class="comment">// must have a trailing 0</span>
<a name="l01355"></a>01355 
<a name="l01356"></a>01356 <span class="keywordtype">int</span> XBeeOsc_PropertySet( <span class="keywordtype">int</span> property, <span class="keywordtype">char</span>* typedata, <span class="keywordtype">int</span> channel );
<a name="l01357"></a>01357 <span class="keywordtype">int</span> XBeeOsc_PropertyGet( <span class="keywordtype">int</span> property, <span class="keywordtype">int</span> channel );
<a name="l01358"></a>01358 
<a name="l01359"></a>01359 <span class="keyword">const</span> <span class="keywordtype">char</span>* XBeeOsc_GetName( <span class="keywordtype">void</span> )
<a name="l01360"></a>01360 {
<a name="l01361"></a>01361   <span class="keywordflow">return</span> XBeeOsc_Name;
<a name="l01362"></a>01362 }
<a name="l01363"></a>01363 
<a name="l01364"></a>01364 <span class="keywordtype">int</span> XBeeOsc_ReceiveMessage( <span class="keywordtype">int</span> channel, <span class="keywordtype">char</span>* message, <span class="keywordtype">int</span> length )
<a name="l01365"></a>01365 {
<a name="l01366"></a>01366   <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( 1 );
<a name="l01367"></a>01367   <span class="keywordtype">int</span> status = <a class="code" href="group___o_s_c_a_p_i.html#gbb24f5e4a4c94eef2c321020941c45b3" title="Receive data for a subsystem that receives a variety of different data types.">Osc_GeneralReceiverHelper</a>( channel, message, length, 
<a name="l01368"></a>01368                                 XBeeOsc_Name,
<a name="l01369"></a>01369                                 XBeeOsc_PropertySet, XBeeOsc_PropertyGet, 
<a name="l01370"></a>01370                                 XBeeOsc_PropertyNames );
<a name="l01371"></a>01371 
<a name="l01372"></a>01372   <span class="keywordflow">if</span> ( status != <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a> )
<a name="l01373"></a>01373     <span class="keywordflow">return</span> Osc_SendError( channel, XBeeOsc_Name, status );
<a name="l01374"></a>01374 
<a name="l01375"></a>01375   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l01376"></a>01376 }
<a name="l01377"></a>01377 
<a name="l01378"></a>01378 <span class="keywordtype">int</span> XBeeOsc_PropertySet( <span class="keywordtype">int</span> property, <span class="keywordtype">char</span>* typedata, <span class="keywordtype">int</span> channel )
<a name="l01379"></a>01379 {
<a name="l01380"></a>01380   <span class="keywordflow">switch</span> ( property )
<a name="l01381"></a>01381   {
<a name="l01382"></a>01382     <span class="keywordflow">case</span> 0: <span class="comment">// active</span>
<a name="l01383"></a>01383     {
<a name="l01384"></a>01384       <span class="keywordtype">int</span> value;
<a name="l01385"></a>01385       <span class="keywordtype">int</span> count = Osc_ExtractData( typedata, <span class="stringliteral">"i"</span>, &amp;value );
<a name="l01386"></a>01386       <span class="keywordflow">if</span> ( count != 1 )
<a name="l01387"></a>01387         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeOsc_Name, <span class="stringliteral">"Incorrect data - need an int"</span> );
<a name="l01388"></a>01388 
<a name="l01389"></a>01389       <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( value );
<a name="l01390"></a>01390       <span class="keywordflow">break</span>;
<a name="l01391"></a>01391     }
<a name="l01392"></a>01392     <span class="keywordflow">case</span> 1: <span class="comment">// io16</span>
<a name="l01393"></a>01393     <span class="keywordflow">case</span> 2: <span class="comment">// rx16</span>
<a name="l01394"></a>01394       <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeOsc_Name, <span class="stringliteral">"Property is read-only"</span> );
<a name="l01395"></a>01395     <span class="keywordflow">case</span> 3: <span class="comment">// autosend</span>
<a name="l01396"></a>01396     {
<a name="l01397"></a>01397       <span class="keywordtype">int</span> value;
<a name="l01398"></a>01398       <span class="keywordtype">int</span> count = Osc_ExtractData( typedata, <span class="stringliteral">"i"</span>, &amp;value );
<a name="l01399"></a>01399       <span class="keywordflow">if</span> ( count != 1 )
<a name="l01400"></a>01400         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeOsc_Name, <span class="stringliteral">"Incorrect data - need an int"</span> );
<a name="l01401"></a>01401 
<a name="l01402"></a>01402       XBee_SetAutoSend( value );
<a name="l01403"></a>01403       <span class="keywordflow">break</span>;
<a name="l01404"></a>01404     }
<a name="l01405"></a>01405   }
<a name="l01406"></a>01406   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l01407"></a>01407 }
<a name="l01408"></a>01408 
<a name="l01409"></a>01409 <span class="keywordtype">int</span> XBeeOsc_PropertyGet( <span class="keywordtype">int</span> property, <span class="keywordtype">int</span> channel )
<a name="l01410"></a>01410 {
<a name="l01411"></a>01411   <span class="keywordflow">switch</span> ( property )
<a name="l01412"></a>01412   {
<a name="l01413"></a>01413     <span class="keywordflow">case</span> 0: <span class="comment">// active</span>
<a name="l01414"></a>01414     {
<a name="l01415"></a>01415       <span class="keywordtype">char</span> address[ OSC_SCRATCH_SIZE ];
<a name="l01416"></a>01416       <span class="keywordtype">int</span> value = <a class="code" href="group___x_bee.html#gb9837489c49f82e3ca25f0da44c58a13" title="Read the active state of the XBee subsystem.">XBee_GetActive</a>( );
<a name="l01417"></a>01417       snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/%s"</span>, XBeeOsc_Name, XBeeOsc_PropertyNames[ property ] ); 
<a name="l01418"></a>01418       Osc_CreateMessage( channel, address, <span class="stringliteral">",i"</span>, value );
<a name="l01419"></a>01419       <span class="keywordflow">break</span>;
<a name="l01420"></a>01420     }
<a name="l01421"></a>01421     <span class="keywordflow">case</span> 1: <span class="comment">// io16</span>
<a name="l01422"></a>01422     <span class="keywordflow">case</span> 2: <span class="comment">// rx16</span>
<a name="l01423"></a>01423       <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeOsc_Name, <span class="stringliteral">"Can't get specific messages - use /xbee/get-message instead."</span> );
<a name="l01424"></a>01424     <span class="keywordflow">case</span> 3: <span class="comment">// autosend</span>
<a name="l01425"></a>01425     {
<a name="l01426"></a>01426       <span class="keywordtype">char</span> address[ OSC_SCRATCH_SIZE ];
<a name="l01427"></a>01427       <span class="keywordtype">int</span> value = XBee_GetAutoSend( <span class="keyword">false</span> );
<a name="l01428"></a>01428       snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/%s"</span>, XBeeOsc_Name, XBeeOsc_PropertyNames[ property ] ); 
<a name="l01429"></a>01429       Osc_CreateMessage( channel, address, <span class="stringliteral">",i"</span>, value );
<a name="l01430"></a>01430       <span class="keywordflow">break</span>;
<a name="l01431"></a>01431     } 
<a name="l01432"></a>01432     <span class="keywordflow">case</span> 4: <span class="comment">// get-message</span>
<a name="l01433"></a>01433     {
<a name="l01434"></a>01434       <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01435"></a>01435       <span class="keywordflow">if</span>( <a class="code" href="group___x_bee.html#gb6f350a2b5dea977c3ab6244e4984833" title="Receive an incoming XBee packet.">XBee_GetPacket</a>( &amp;xbp, XBEE_OSC_RX_TIMEOUT ) )
<a name="l01436"></a>01436         XBeeOsc_HandleNewPacket( XBee-&gt;currentPkt, channel );
<a name="l01437"></a>01437       <span class="keywordflow">break</span>;
<a name="l01438"></a>01438     }
<a name="l01439"></a>01439   }
<a name="l01440"></a>01440   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l01441"></a>01441 }
<a name="l01442"></a>01442 <span class="comment"></span>
<a name="l01443"></a>01443 <span class="comment">/** \defgroup XBeeConfigOSC XBee Configuration - OSC</span>
<a name="l01444"></a>01444 <span class="comment">  Configure an XBee module connected to your Make Controller Kit via OSC.</span>
<a name="l01445"></a>01445 <span class="comment">  \ingroup OSC</span>
<a name="l01446"></a>01446 <span class="comment">  </span>
<a name="l01447"></a>01447 <span class="comment">  \section devices Devices</span>
<a name="l01448"></a>01448 <span class="comment">  There can only be one XBee board connected to the Make Controller Kit's serial port at a time,</span>
<a name="l01449"></a>01449 <span class="comment">  so there is not a device index in XBee Config OSC messages.</span>
<a name="l01450"></a>01450 <span class="comment">  </span>
<a name="l01451"></a>01451 <span class="comment">  \section properties Properties</span>
<a name="l01452"></a>01452 <span class="comment">  The XBee Config system has the following properties:</span>
<a name="l01453"></a>01453 <span class="comment">  - write</span>
<a name="l01454"></a>01454 <span class="comment">  - get-message</span>
<a name="l01455"></a>01455 <span class="comment">  - packet-mode</span>
<a name="l01456"></a>01456 <span class="comment">  - samplerate</span>
<a name="l01457"></a>01457 <span class="comment">  - address</span>
<a name="l01458"></a>01458 <span class="comment">  - panid</span>
<a name="l01459"></a>01459 <span class="comment">  - channel</span>
<a name="l01460"></a>01460 <span class="comment">  - at-command</span>
<a name="l01461"></a>01461 <span class="comment">  - io</span>
<a name="l01462"></a>01462 <span class="comment">  - active</span>
<a name="l01463"></a>01463 <span class="comment"></span>
<a name="l01464"></a>01464 <span class="comment">  Reading values from the XBee Config system is a bit different than the other systems.  Because we need to see any messages</span>
<a name="l01465"></a>01465 <span class="comment">  that arrive at the XBee module and not just the one we're requesting at a given moment, to get any message back you need to </span>
<a name="l01466"></a>01466 <span class="comment">  use the \b get-message property.  Imagine the case where we want to ask the module its address, but another module is busy </span>
<a name="l01467"></a>01467 <span class="comment">  sending us sensor values.  If we waited for the address message, we'd miss all the sensor values.  </span>
<a name="l01468"></a>01468 <span class="comment"></span>
<a name="l01469"></a>01469 <span class="comment">  So to read a value, first send the request then call \b get-message until you get the response you're looking for.</span>
<a name="l01470"></a>01470 <span class="comment">  If you have autosend turned on, it will get messages for you, so you just need to send the request - this is much</span>
<a name="l01471"></a>01471 <span class="comment">  easier.</span>
<a name="l01472"></a>01472 <span class="comment">  </span>
<a name="l01473"></a>01473 <span class="comment">  \par Write</span>
<a name="l01474"></a>01474 <span class="comment">  When you change any of the paramters of your XBee module, it will by default revert back to its previous settings</span>
<a name="l01475"></a>01475 <span class="comment">  when it gets powered down.  The \b write property sets the current values (all of them) into memory.</span>
<a name="l01476"></a>01476 <span class="comment">  \par</span>
<a name="l01477"></a>01477 <span class="comment">  For example, to set the sample rate to 100 milliseconds, and save it permanently, send the messages</span>
<a name="l01478"></a>01478 <span class="comment">  \verbatim </span>
<a name="l01479"></a>01479 <span class="comment">  /xbeeconfig/samplerate 100</span>
<a name="l01480"></a>01480 <span class="comment">  /xbeeconfig/write 1 \endverbatim</span>
<a name="l01481"></a>01481 <span class="comment"></span>
<a name="l01482"></a>01482 <span class="comment">  \par Get Message</span>
<a name="l01483"></a>01483 <span class="comment">  The \b get-message property fetches the most recent message received by the XBee module.  If you have autosend</span>
<a name="l01484"></a>01484 <span class="comment">  turned on, you don't need to use get-message and, in fact, it won't have any effect.</span>
<a name="l01485"></a>01485 <span class="comment">  To get a message from your XBee module, send the message</span>
<a name="l01486"></a>01486 <span class="comment">  \verbatim /xbeeconfig/get-message\endverbatim</span>
<a name="l01487"></a>01487 <span class="comment">  and the board will send one back if there were any available.</span>
<a name="l01488"></a>01488 <span class="comment">  </span>
<a name="l01489"></a>01489 <span class="comment">  \par Sample Rate</span>
<a name="l01490"></a>01490 <span class="comment">  The \b samplerate property corresponds to how often the XBee module will sample its IO pins and send a message</span>
<a name="l01491"></a>01491 <span class="comment">  with those values.  If it's set to 0, the module will not sample its IO pins.  The maximum sample rate is 65535.</span>
<a name="l01492"></a>01492 <span class="comment">  When the sample rate is set very low, the XBee module cannot guarantee that it will be able to keep up with all</span>
<a name="l01493"></a>01493 <span class="comment">  the samples requested of it.</span>
<a name="l01494"></a>01494 <span class="comment">  \par</span>
<a name="l01495"></a>01495 <span class="comment">  To set the sample rate to once a second (every 1000 milliseconds), send the message</span>
<a name="l01496"></a>01496 <span class="comment">  \verbatim /xbeeconfig/samplerate 1000\endverbatim</span>
<a name="l01497"></a>01497 <span class="comment">  To read the sample rate, send the message</span>
<a name="l01498"></a>01498 <span class="comment">  \verbatim /xbeeconfig/samplerate \endverbatim</span>
<a name="l01499"></a>01499 <span class="comment"></span>
<a name="l01500"></a>01500 <span class="comment">  \par Address</span>
<a name="l01501"></a>01501 <span class="comment">  The \b address property corresponds to the address of the XBee module.  Valid ranges for the address are</span>
<a name="l01502"></a>01502 <span class="comment">  from 0 - 65535.</span>
<a name="l01503"></a>01503 <span class="comment">  \par</span>
<a name="l01504"></a>01504 <span class="comment">  To set the address to 1234, send the message</span>
<a name="l01505"></a>01505 <span class="comment">  \verbatim /xbeeconfig/address 1234\endverbatim</span>
<a name="l01506"></a>01506 <span class="comment">  To read the address, send the message</span>
<a name="l01507"></a>01507 <span class="comment">  \verbatim /xbeeconfig/address \endverbatim</span>
<a name="l01508"></a>01508 <span class="comment"></span>
<a name="l01509"></a>01509 <span class="comment">  \par Channel</span>
<a name="l01510"></a>01510 <span class="comment">  The \b channel property corresponds to the channel of the XBee module.  Valid ranges for the address are</span>
<a name="l01511"></a>01511 <span class="comment">  from 11 - 26 for XBee modules and 12 - 23 for XBee Pro modules.</span>
<a name="l01512"></a>01512 <span class="comment">  \par</span>
<a name="l01513"></a>01513 <span class="comment">  To set the channel to 15, send the message</span>
<a name="l01514"></a>01514 <span class="comment">  \verbatim /xbeeconfig/channel 15\endverbatim</span>
<a name="l01515"></a>01515 <span class="comment">  To read the channel, send the message</span>
<a name="l01516"></a>01516 <span class="comment">  \verbatim /xbeeconfig/channel \endverbatim</span>
<a name="l01517"></a>01517 <span class="comment">  </span>
<a name="l01518"></a>01518 <span class="comment">  \par AT Command</span>
<a name="l01519"></a>01519 <span class="comment">  The \b at-command property allows you to read/write AT commands to your XBee module via OSC.  The most common</span>
<a name="l01520"></a>01520 <span class="comment">  commands are included - samplerate, channel, address, etc. but this is helpful if you need to send any of the</span>
<a name="l01521"></a>01521 <span class="comment">  other commands to your module.  To write a command, specify the 2-letter command and then the value to set.  </span>
<a name="l01522"></a>01522 <span class="comment">  To enable encryption, for example, send the message</span>
<a name="l01523"></a>01523 <span class="comment">  \verbatim /xbeeconfig/at-command EE 1\endverbatim</span>
<a name="l01524"></a>01524 <span class="comment">  \par</span>
<a name="l01525"></a>01525 <span class="comment">  To read a value back via an AT command, simply send the 2-letter command you'd like to get the value for.</span>
<a name="l01526"></a>01526 <span class="comment">  To read back the hardware version, send the message</span>
<a name="l01527"></a>01527 <span class="comment">  \verbatim /xbeeconfig/at-command HV\endverbatim</span>
<a name="l01528"></a>01528 <span class="comment">  Check the XBee documentation for a complete list of commands the boards will respond to.</span>
<a name="l01529"></a>01529 <span class="comment"></span>
<a name="l01530"></a>01530 <span class="comment">  \par PAN ID</span>
<a name="l01531"></a>01531 <span class="comment">  The \b panid property corresponds to the Personal Area Network ID of the XBee module.  Valid ranges for the address are</span>
<a name="l01532"></a>01532 <span class="comment">  from 0 - 65535.  The default value is 13106.</span>
<a name="l01533"></a>01533 <span class="comment">  \par</span>
<a name="l01534"></a>01534 <span class="comment">  To set the PAN ID to 512, send the message</span>
<a name="l01535"></a>01535 <span class="comment">  \verbatim /xbeeconfig/panid 512\endverbatim</span>
<a name="l01536"></a>01536 <span class="comment">  To read the PAN ID, send the message</span>
<a name="l01537"></a>01537 <span class="comment">  \verbatim /xbeeconfig/panid \endverbatim</span>
<a name="l01538"></a>01538 <span class="comment">  </span>
<a name="l01539"></a>01539 <span class="comment">  \par Input/Output Pins</span>
<a name="l01540"></a>01540 <span class="comment">  There are several \b io properties that allow you to configure each of the 9 IO pins on the XBee module.  </span>
<a name="l01541"></a>01541 <span class="comment">  Pins can be set to one of 5 values:</span>
<a name="l01542"></a>01542 <span class="comment">  - \b 0 - disabled</span>
<a name="l01543"></a>01543 <span class="comment">  - \b 2 - analogin</span>
<a name="l01544"></a>01544 <span class="comment">  - \b 3 - digital in</span>
<a name="l01545"></a>01545 <span class="comment">  - \b 4 - digital out high</span>
<a name="l01546"></a>01546 <span class="comment">  - \b 5 - digital out low</span>
<a name="l01547"></a>01547 <span class="comment">  </span>
<a name="l01548"></a>01548 <span class="comment">  \par</span>
<a name="l01549"></a>01549 <span class="comment">  There are 9 IO pins on the XBee module, numbered 0 - 8. Send messages to them by specifying \b io + their number.  </span>
<a name="l01550"></a>01550 <span class="comment">  Pin 8 cannot be an analogin - it can only be a digital in or out.</span>
<a name="l01551"></a>01551 <span class="comment">  For example,  to set IO 0 to analogin, send the message</span>
<a name="l01552"></a>01552 <span class="comment">  \verbatim /xbeeconfig/io0 2\endverbatim</span>
<a name="l01553"></a>01553 <span class="comment">  To set IO 6 to a digital in, send the message</span>
<a name="l01554"></a>01554 <span class="comment">  \verbatim /xbeeconfig/io6 3\endverbatim</span>
<a name="l01555"></a>01555 <span class="comment">  To read the configuration of pin 5, send the message</span>
<a name="l01556"></a>01556 <span class="comment">  \verbatim /xbeeconfig/io5 \endverbatim</span>
<a name="l01557"></a>01557 <span class="comment">  </span>
<a name="l01558"></a>01558 <span class="comment">  \par Active</span>
<a name="l01559"></a>01559 <span class="comment">  The \b active property corresponds to the active state of the XBee system.</span>
<a name="l01560"></a>01560 <span class="comment">  If you're not seeing appropriate responses to your messages to the XBee system, </span>
<a name="l01561"></a>01561 <span class="comment">  check whether it's active by sending the message</span>
<a name="l01562"></a>01562 <span class="comment">  \verbatim /xbee/active \endverbatim</span>
<a name="l01563"></a>01563 <span class="comment">  \par</span>
<a name="l01564"></a>01564 <span class="comment">  You can set the active flag by sending</span>
<a name="l01565"></a>01565 <span class="comment">  \verbatim /xbee/active 1 \endverbatim</span>
<a name="l01566"></a>01566 <span class="comment">*/</span>
<a name="l01567"></a>01567 
<a name="l01568"></a>01568 <span class="keyword">static</span> <span class="keywordtype">char</span>* XBeeConfigOsc_Name = <span class="stringliteral">"xbeeconfig"</span>;
<a name="l01569"></a>01569 <span class="keyword">static</span> <span class="keywordtype">char</span>* XBeeConfigOsc_PropertyNames[] = { <span class="stringliteral">"active"</span>, <span class="stringliteral">"address"</span>, <span class="stringliteral">"panid"</span>, <span class="stringliteral">"channel"</span>, <span class="stringliteral">"samplerate"</span>, 
<a name="l01570"></a>01570                                                 <span class="stringliteral">"write"</span>, <span class="stringliteral">"io0"</span>, <span class="stringliteral">"io1"</span>, <span class="stringliteral">"io2"</span>, <span class="stringliteral">"io3"</span>, <span class="stringliteral">"io4"</span>, 
<a name="l01571"></a>01571                                                 <span class="stringliteral">"io5"</span>, <span class="stringliteral">"io6"</span>, <span class="stringliteral">"io7"</span>, <span class="stringliteral">"io8"</span>, <span class="stringliteral">"packet-mode"</span>, <span class="stringliteral">"at-command"</span>, 
<a name="l01572"></a>01572                                                 <span class="stringliteral">"get-message"</span>, <span class="stringliteral">"write-command"</span>, <span class="stringliteral">"confirm"</span>, 0 }; <span class="comment">// must have a trailing 0</span>
<a name="l01573"></a>01573 
<a name="l01574"></a>01574 <span class="keywordtype">int</span> XBeeConfigOsc_PropertySet( <span class="keywordtype">int</span> property, <span class="keywordtype">char</span>* typedata, <span class="keywordtype">int</span> channel );
<a name="l01575"></a>01575 <span class="keywordtype">int</span> XBeeConfigOsc_PropertyGet( <span class="keywordtype">int</span> property, <span class="keywordtype">int</span> channel );
<a name="l01576"></a>01576 
<a name="l01577"></a>01577 <span class="keyword">const</span> <span class="keywordtype">char</span>* XBeeConfigOsc_GetName( <span class="keywordtype">void</span> )
<a name="l01578"></a>01578 {
<a name="l01579"></a>01579   <span class="keywordflow">return</span> XBeeConfigOsc_Name;
<a name="l01580"></a>01580 }
<a name="l01581"></a>01581 
<a name="l01582"></a>01582 <span class="keywordtype">int</span> XBeeConfigOsc_PropertySet( <span class="keywordtype">int</span> property, <span class="keywordtype">char</span>* typedata, <span class="keywordtype">int</span> channel )
<a name="l01583"></a>01583 {
<a name="l01584"></a>01584   <span class="keywordtype">int</span> value = -1;
<a name="l01585"></a>01585   <span class="keywordtype">int</span> count;
<a name="l01586"></a>01586   <span class="keywordflow">switch</span> ( property )
<a name="l01587"></a>01587   {
<a name="l01588"></a>01588     <span class="keywordflow">case</span> 0: <span class="comment">// active</span>
<a name="l01589"></a>01589       count = Osc_ExtractData( typedata, <span class="stringliteral">"i"</span>, &amp;value );
<a name="l01590"></a>01590       <span class="keywordflow">if</span> ( count != 1 )
<a name="l01591"></a>01591         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need an int"</span> );
<a name="l01592"></a>01592       <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( value );
<a name="l01593"></a>01593       <span class="keywordflow">break</span>;
<a name="l01594"></a>01594     <span class="keywordflow">case</span> 1: <span class="comment">// address</span>
<a name="l01595"></a>01595       count = Osc_ExtractData( typedata, <span class="stringliteral">"i"</span>, &amp;value );
<a name="l01596"></a>01596       <span class="keywordflow">if</span> ( count != 1 )
<a name="l01597"></a>01597         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need an int"</span> );
<a name="l01598"></a>01598       <a class="code" href="group___x_bee.html#gf6eb50d7c632ccadf35d89bebf30ba4a" title="Set this module&amp;#39;s address.">XBeeConfig_SetAddress</a>( value );
<a name="l01599"></a>01599       <span class="keywordflow">break</span>;
<a name="l01600"></a>01600     <span class="keywordflow">case</span> 2: <span class="comment">// panid</span>
<a name="l01601"></a>01601       count = Osc_ExtractData( typedata, <span class="stringliteral">"i"</span>, &amp;value );
<a name="l01602"></a>01602       <span class="keywordflow">if</span> ( count != 1 )
<a name="l01603"></a>01603         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need an int"</span> );
<a name="l01604"></a>01604       <a class="code" href="group___x_bee.html#gbb8511090eee4d72a26bf55fb44bcd68" title="Set this PAN (Personal Area Network) ID.">XBeeConfig_SetPanID</a>( value );
<a name="l01605"></a>01605       <span class="keywordflow">break</span>;
<a name="l01606"></a>01606     <span class="keywordflow">case</span> 3: <span class="comment">// channel</span>
<a name="l01607"></a>01607       count = Osc_ExtractData( typedata, <span class="stringliteral">"i"</span>, &amp;value );
<a name="l01608"></a>01608       <span class="keywordflow">if</span> ( count != 1 )
<a name="l01609"></a>01609         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need an int"</span> );
<a name="l01610"></a>01610       <a class="code" href="group___x_bee.html#gd5fd4ac5a68e76d7a16b3e685f05a4f8" title="Set the module&amp;#39;s channel.">XBeeConfig_SetChannel</a>( value );
<a name="l01611"></a>01611       <span class="keywordflow">break</span>;
<a name="l01612"></a>01612     <span class="keywordflow">case</span> 4: <span class="comment">// samplerate</span>
<a name="l01613"></a>01613       count = Osc_ExtractData( typedata, <span class="stringliteral">"i"</span>, &amp;value );
<a name="l01614"></a>01614       <span class="keywordflow">if</span> ( count != 1 )
<a name="l01615"></a>01615         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need an int"</span> );
<a name="l01616"></a>01616       <a class="code" href="group___x_bee.html#g35826df514efda2aab33f86cf0e24f2e" title="Set the rate at which the module will sample its IO pins.">XBeeConfig_SetSampleRate</a>( value );
<a name="l01617"></a>01617       <span class="keywordflow">break</span>;
<a name="l01618"></a>01618     <span class="keywordflow">case</span> 5: <span class="comment">// write</span>
<a name="l01619"></a>01619       count = Osc_ExtractData( typedata, <span class="stringliteral">"i"</span>, &amp;value );
<a name="l01620"></a>01620       <span class="keywordflow">if</span> ( count != 1 )
<a name="l01621"></a>01621         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need an int"</span> );
<a name="l01622"></a>01622       <a class="code" href="group___x_bee.html#g60564c155b8d6a6e73a9bfa54917ebd2" title="Save the configuration changes you&amp;#39;ve made on the module to memory.">XBeeConfig_WriteStateToMemory</a>( );
<a name="l01623"></a>01623       <span class="keywordflow">break</span>;
<a name="l01624"></a>01624     <span class="keywordflow">case</span> 6: <span class="comment">// io0</span>
<a name="l01625"></a>01625     <span class="keywordflow">case</span> 7: <span class="comment">// io1</span>
<a name="l01626"></a>01626     <span class="keywordflow">case</span> 8: <span class="comment">// io2</span>
<a name="l01627"></a>01627     <span class="keywordflow">case</span> 9: <span class="comment">// io3</span>
<a name="l01628"></a>01628     <span class="keywordflow">case</span> 10: <span class="comment">// io4</span>
<a name="l01629"></a>01629     <span class="keywordflow">case</span> 11: <span class="comment">// io5</span>
<a name="l01630"></a>01630     <span class="keywordflow">case</span> 12: <span class="comment">// io6</span>
<a name="l01631"></a>01631     <span class="keywordflow">case</span> 13: <span class="comment">// io7</span>
<a name="l01632"></a>01632     <span class="keywordflow">case</span> 14: <span class="comment">// io8</span>
<a name="l01633"></a>01633       count = Osc_ExtractData( typedata, <span class="stringliteral">"i"</span>, &amp;value );
<a name="l01634"></a>01634       <span class="keywordflow">if</span> ( count != 1 )
<a name="l01635"></a>01635         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need an int"</span> );
<a name="l01636"></a>01636       <a class="code" href="group___x_bee.html#g2a1939254f9174e0ee2c33a4d2ff8ba3" title="Configure the IO settings on an XBee module.">XBeeConfig_SetIO</a>( property - 6, value );
<a name="l01637"></a>01637       <span class="keywordflow">break</span>;
<a name="l01638"></a>01638     <span class="keywordflow">case</span> 15: <span class="comment">// packet-mode</span>
<a name="l01639"></a>01639       count = Osc_ExtractData( typedata, <span class="stringliteral">"i"</span>, &amp;value );
<a name="l01640"></a>01640       <span class="keywordflow">if</span> ( count != 1 )
<a name="l01641"></a>01641         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need an int"</span> );
<a name="l01642"></a>01642       <a class="code" href="group___x_bee.html#gb3abc9b61091749d5aa7a48e8aa35e18" title="Set a module into packet API mode.">XBeeConfig_SetPacketApiMode</a>( value );
<a name="l01643"></a>01643       <span class="keywordflow">break</span>;
<a name="l01644"></a>01644     <span class="keywordflow">case</span> 16: <span class="comment">// at-command</span>
<a name="l01645"></a>01645     {
<a name="l01646"></a>01646       <span class="keywordtype">char</span>* cmd;
<a name="l01647"></a>01647       count = Osc_ExtractData( typedata, <span class="stringliteral">"si"</span>, &amp;cmd, &amp;value );
<a name="l01648"></a>01648       <span class="keywordflow">if</span> ( count != 2 &amp;&amp; count != 1 )
<a name="l01649"></a>01649         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need a string, optionally followed by an int"</span> );
<a name="l01650"></a>01650       
<a name="l01651"></a>01651       <span class="keywordflow">if</span>( count == 2 )
<a name="l01652"></a>01652       {
<a name="l01653"></a>01653         <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01654"></a>01654         uint8 params[4]; <span class="comment">// big endian - most significant bit first</span>
<a name="l01655"></a>01655         <a class="code" href="group___x_bee.html#gd357b57c2604013a69ec60e746318f89" title="Convert a 32-bit integer into a big endian array of 4 unsigned 8-bit integers.">XBee_IntToBigEndianArray</a>( value, params );
<a name="l01656"></a>01656         <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0, cmd, params, 4 );
<a name="l01657"></a>01657         <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 4 );
<a name="l01658"></a>01658       }
<a name="l01659"></a>01659       <span class="keywordflow">if</span>( count == 1 ) <span class="comment">// this is a little wonky, but this is actually a read.</span>
<a name="l01660"></a>01660         value = <a class="code" href="group___x_bee.html#g2f0a97c1a7ce219eb7ccd807e8a860e2" title="Query the address of the module.">XBeeConfig_RequestATResponse</a>( cmd );
<a name="l01661"></a>01661       <span class="keywordflow">break</span>;
<a name="l01662"></a>01662     }
<a name="l01663"></a>01663     <span class="keywordflow">case</span> 18: <span class="comment">// write-command</span>
<a name="l01664"></a>01664     {
<a name="l01665"></a>01665       <span class="keywordtype">char</span>* cmd;
<a name="l01666"></a>01666       count = Osc_ExtractData( typedata, <span class="stringliteral">"si"</span>, &amp;cmd, &amp;value );
<a name="l01667"></a>01667       <span class="keywordflow">if</span> ( count != 2 )
<a name="l01668"></a>01668         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need a string and an int"</span> );
<a name="l01669"></a>01669       <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01670"></a>01670       uint8 params[4]; <span class="comment">// big endian - most significant bit first</span>
<a name="l01671"></a>01671       <a class="code" href="group___x_bee.html#gd357b57c2604013a69ec60e746318f89" title="Convert a 32-bit integer into a big endian array of 4 unsigned 8-bit integers.">XBee_IntToBigEndianArray</a>( value, params );
<a name="l01672"></a>01672       <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0, cmd, params, 4 );
<a name="l01673"></a>01673       <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 4 );
<a name="l01674"></a>01674       <a class="code" href="group___x_bee.html#g066e28d0aaafb23eb1171bcdb31e5c45" title="Initialize a packet before reading into it.">XBee_ResetPacket</a>( &amp;xbp );
<a name="l01675"></a>01675       <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0, <span class="stringliteral">"WR"</span>, NULL, 0 );
<a name="l01676"></a>01676       <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 0 ); 
<a name="l01677"></a>01677       <span class="keywordflow">break</span>;
<a name="l01678"></a>01678     }
<a name="l01679"></a>01679     <span class="keywordflow">case</span> 19: <span class="comment">// confirm</span>
<a name="l01680"></a>01680     {
<a name="l01681"></a>01681       <span class="keywordtype">char</span>* cmd;
<a name="l01682"></a>01682       count = Osc_ExtractData( typedata, <span class="stringliteral">"si"</span>, &amp;cmd, &amp;value );
<a name="l01683"></a>01683       <span class="keywordflow">if</span> ( count != 2 )
<a name="l01684"></a>01684         <span class="keywordflow">return</span> <a class="code" href="group___o_s_c_a_p_i.html#g852200f3d0612d90d73e9f233392ec2d" title="Send an error back via OSC from your subsystem.">Osc_SubsystemError</a>( channel, XBeeConfigOsc_Name, <span class="stringliteral">"Incorrect data - need a string and an int"</span> );
<a name="l01685"></a>01685       <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01686"></a>01686       uint8 params[4]; <span class="comment">// big endian - most significant bit first</span>
<a name="l01687"></a>01687       <a class="code" href="group___x_bee.html#gd357b57c2604013a69ec60e746318f89" title="Convert a 32-bit integer into a big endian array of 4 unsigned 8-bit integers.">XBee_IntToBigEndianArray</a>( value, params );
<a name="l01688"></a>01688 
<a name="l01689"></a>01689       XBee-&gt;waitingForConfirm = <span class="keyword">true</span>;
<a name="l01690"></a>01690       <a class="code" href="group___tasks.html#g9a64a7c0e24f257826103d1d1bbb44fa" title="Put a task to sleep for a given number of milliseconds.">Sleep</a>( System_GetAutoSendInterval( ) + 1 ); <span class="comment">// make sure autosend isn't grabbing packets if it's on</span>
<a name="l01691"></a>01691       <a class="code" href="group___x_bee.html#g066e28d0aaafb23eb1171bcdb31e5c45" title="Initialize a packet before reading into it.">XBee_ResetPacket</a>( XBee-&gt;currentPkt );
<a name="l01692"></a>01692       <span class="keywordflow">while</span>( <span class="keyword">true</span> )
<a name="l01693"></a>01693       {
<a name="l01694"></a>01694         <span class="comment">// send the setter</span>
<a name="l01695"></a>01695         <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0x53, cmd, params, 4 );
<a name="l01696"></a>01696         <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 4 );
<a name="l01697"></a>01697         <a class="code" href="group___x_bee.html#g066e28d0aaafb23eb1171bcdb31e5c45" title="Initialize a packet before reading into it.">XBee_ResetPacket</a>( &amp;xbp );
<a name="l01698"></a>01698         <span class="comment">// then the getter</span>
<a name="l01699"></a>01699         <a class="code" href="group___x_bee.html#g2c4ec9c048a04f7d7b46850377e51008" title="A convenience function for creating an AT command packet.">XBee_CreateATCommandPacket</a>( &amp;xbp, 0x52, cmd, NULL, 0 );
<a name="l01700"></a>01700         <a class="code" href="group___x_bee.html#g88dd9f12ff38f318e59ec8e8283a78d3" title="Send an XBee packet.">XBee_SendPacket</a>( &amp;xbp, 0 );
<a name="l01701"></a>01701         <a class="code" href="group___x_bee.html#g066e28d0aaafb23eb1171bcdb31e5c45" title="Initialize a packet before reading into it.">XBee_ResetPacket</a>( &amp;xbp );
<a name="l01702"></a>01702         <span class="comment">// and try to get it</span>
<a name="l01703"></a>01703         <span class="keywordflow">if</span>( <a class="code" href="group___x_bee.html#gb6f350a2b5dea977c3ab6244e4984833" title="Receive an incoming XBee packet.">XBee_GetPacket</a>( XBee-&gt;currentPkt, 5 ) )
<a name="l01704"></a>01704         {
<a name="l01705"></a>01705           XBeeOsc_HandleNewPacket( XBee-&gt;currentPkt, channel );
<a name="l01706"></a>01706           <span class="keywordflow">break</span>;
<a name="l01707"></a>01707         }
<a name="l01708"></a>01708         <a class="code" href="group___tasks.html#g9a64a7c0e24f257826103d1d1bbb44fa" title="Put a task to sleep for a given number of milliseconds.">Sleep</a>( 1 );
<a name="l01709"></a>01709       }
<a name="l01710"></a>01710       XBee-&gt;waitingForConfirm = <span class="keyword">false</span>;
<a name="l01711"></a>01711       <span class="keywordflow">break</span>;
<a name="l01712"></a>01712     }
<a name="l01713"></a>01713   }
<a name="l01714"></a>01714   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l01715"></a>01715 }
<a name="l01716"></a>01716 
<a name="l01717"></a>01717 <span class="keywordtype">int</span> XBeeConfigOsc_PropertyGet( <span class="keywordtype">int</span> property, <span class="keywordtype">int</span> channel )
<a name="l01718"></a>01718 {
<a name="l01719"></a>01719   <span class="keywordtype">char</span> address[ OSC_SCRATCH_SIZE ];
<a name="l01720"></a>01720   <span class="keywordflow">switch</span> ( property )
<a name="l01721"></a>01721   {
<a name="l01722"></a>01722     <span class="keywordflow">case</span> 0: <span class="comment">// active</span>
<a name="l01723"></a>01723     {
<a name="l01724"></a>01724       <span class="keywordtype">int</span> value = <a class="code" href="group___x_bee.html#gb9837489c49f82e3ca25f0da44c58a13" title="Read the active state of the XBee subsystem.">XBee_GetActive</a>( );
<a name="l01725"></a>01725       snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/%s"</span>, XBeeConfigOsc_Name, XBeeConfigOsc_PropertyNames[ property ] ); 
<a name="l01726"></a>01726       Osc_CreateMessage( channel, address, <span class="stringliteral">",i"</span>, value );
<a name="l01727"></a>01727       <span class="keywordflow">break</span>;
<a name="l01728"></a>01728     }
<a name="l01729"></a>01729     <span class="keywordflow">case</span> 1: <span class="comment">// address</span>
<a name="l01730"></a>01730       <a class="code" href="group___x_bee.html#gcca92909fdf6d844af5da5a13b1d1303" title="Query the address of the module.">XBeeConfig_RequestAddress</a>( );
<a name="l01731"></a>01731       <span class="keywordflow">break</span>;
<a name="l01732"></a>01732     <span class="keywordflow">case</span> 2: <span class="comment">// panid</span>
<a name="l01733"></a>01733       <a class="code" href="group___x_bee.html#gd24a98ab72e3e7767982e59ba663c003" title="Query the PAN ID of the module.">XBeeConfig_RequestPanID</a>( );
<a name="l01734"></a>01734       <span class="keywordflow">break</span>;
<a name="l01735"></a>01735     <span class="keywordflow">case</span> 3: <span class="comment">// channel</span>
<a name="l01736"></a>01736       <a class="code" href="group___x_bee.html#ga893d7c545c7b39c0f6909be757751fd" title="Query the channel of the module.">XBeeConfig_RequestChannel</a>( );
<a name="l01737"></a>01737       <span class="keywordflow">break</span>;
<a name="l01738"></a>01738     <span class="keywordflow">case</span> 4: <span class="comment">// samplerate</span>
<a name="l01739"></a>01739       <a class="code" href="group___x_bee.html#g00ce3bb898806b5cf6bb257dfb24ca9c" title="Query the sample rate of the module.">XBeeConfig_RequestSampleRate</a>( );
<a name="l01740"></a>01740       <span class="keywordflow">break</span>;
<a name="l01741"></a>01741     <span class="keywordflow">case</span> 6: <span class="comment">// ios</span>
<a name="l01742"></a>01742     <span class="keywordflow">case</span> 7:
<a name="l01743"></a>01743     <span class="keywordflow">case</span> 8:
<a name="l01744"></a>01744     <span class="keywordflow">case</span> 9:
<a name="l01745"></a>01745     <span class="keywordflow">case</span> 10:
<a name="l01746"></a>01746     <span class="keywordflow">case</span> 11:
<a name="l01747"></a>01747     <span class="keywordflow">case</span> 12:
<a name="l01748"></a>01748     <span class="keywordflow">case</span> 13:
<a name="l01749"></a>01749     <span class="keywordflow">case</span> 14:
<a name="l01750"></a>01750       <a class="code" href="group___x_bee.html#g471f419a8be85dff56cb190ac1122df3" title="Query the configuration of an IO pin.">XBeeConfig_RequestIO</a>( property - 6 ); <span class="comment">// send the query</span>
<a name="l01751"></a>01751       <span class="keywordflow">break</span>;
<a name="l01752"></a>01752     <span class="keywordflow">case</span> 15: <span class="comment">// packet-mode</span>
<a name="l01753"></a>01753       <a class="code" href="group___x_bee.html#g5d8c12d4fba507727eded9aad78f5126" title="Query whether the module is in API mode.">XBeeConfig_RequestPacketApiMode</a>( ); <span class="comment">// send the query</span>
<a name="l01754"></a>01754       <span class="keywordflow">break</span>;
<a name="l01755"></a>01755     <span class="keywordflow">case</span> 17: <span class="comment">// get-message</span>
<a name="l01756"></a>01756     {
<a name="l01757"></a>01757       <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a> xbp;
<a name="l01758"></a>01758       <span class="keywordflow">if</span>( <a class="code" href="group___x_bee.html#gb6f350a2b5dea977c3ab6244e4984833" title="Receive an incoming XBee packet.">XBee_GetPacket</a>( &amp;xbp, XBEE_OSC_RX_TIMEOUT ) )
<a name="l01759"></a>01759         XBeeOsc_HandleNewPacket( XBee-&gt;currentPkt, channel );
<a name="l01760"></a>01760       <span class="keywordflow">break</span>;
<a name="l01761"></a>01761     }
<a name="l01762"></a>01762   }
<a name="l01763"></a>01763   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l01764"></a>01764 }
<a name="l01765"></a>01765 
<a name="l01766"></a>01766 <span class="keywordtype">int</span> XBeeConfigOsc_ReceiveMessage( <span class="keywordtype">int</span> channel, <span class="keywordtype">char</span>* message, <span class="keywordtype">int</span> length )
<a name="l01767"></a>01767 {
<a name="l01768"></a>01768   <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( 1 );
<a name="l01769"></a>01769   <span class="keywordtype">int</span> status = <a class="code" href="group___o_s_c_a_p_i.html#gbb24f5e4a4c94eef2c321020941c45b3" title="Receive data for a subsystem that receives a variety of different data types.">Osc_GeneralReceiverHelper</a>( channel, message, length, 
<a name="l01770"></a>01770                                 XBeeConfigOsc_Name,
<a name="l01771"></a>01771                                 XBeeConfigOsc_PropertySet, XBeeConfigOsc_PropertyGet, 
<a name="l01772"></a>01772                                 XBeeConfigOsc_PropertyNames );
<a name="l01773"></a>01773 
<a name="l01774"></a>01774   <span class="keywordflow">if</span> ( status != <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a> )
<a name="l01775"></a>01775     <span class="keywordflow">return</span> Osc_SendError( channel, XBeeConfigOsc_Name, status );
<a name="l01776"></a>01776 
<a name="l01777"></a>01777   <span class="keywordflow">return</span> <a class="code" href="group___error.html#gaa42bc036fbba18487ae9a15cd1f2f94" title="All&amp;#39;s well here.">CONTROLLER_OK</a>;
<a name="l01778"></a>01778 }
<a name="l01779"></a>01779 
<a name="l01780"></a>01780 <span class="keywordtype">int</span> XBeeOsc_HandleNewPacket( <a class="code" href="struct_x_bee_packet.html" title="Representation of an XBee packet.">XBeePacket</a>* xbp, <span class="keywordtype">int</span> channel )
<a name="l01781"></a>01781 {
<a name="l01782"></a>01782   <span class="keywordtype">char</span> address[OSC_SCRATCH_SIZE];
<a name="l01783"></a>01783   <span class="keywordtype">int</span> retval = xbp-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a>;
<a name="l01784"></a>01784   <span class="keywordflow">switch</span>( xbp-&gt;<a class="code" href="struct_x_bee_packet.html#15dc350270da6374823499b919605c8f" title="the API ID for this packet that subsequent response/status messages can refer to...">apiId</a> )
<a name="l01785"></a>01785   {
<a name="l01786"></a>01786     <span class="keywordflow">case</span> <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d846f28614466ea9fcf78dc3e10c806275c" title="An incoming data packet with a 16-bit address.">XBEE_RX16</a>:
<a name="l01787"></a>01787     {
<a name="l01788"></a>01788       uint16 srcAddr;
<a name="l01789"></a>01789       uint8 sigStrength;
<a name="l01790"></a>01790       uint8 opts;
<a name="l01791"></a>01791       uint8* data;
<a name="l01792"></a>01792       uint8 datalen;
<a name="l01793"></a>01793       <span class="keywordflow">if</span>( <a class="code" href="group___x_bee.html#g90063926b2e0055e8476887828e8eaa4" title="Unpack the info from an incoming packet with a 16-bit address.">XBee_ReadRX16Packet</a>( xbp, &amp;srcAddr, &amp;sigStrength, &amp;opts, &amp;data, &amp;datalen ) )
<a name="l01794"></a>01794       {
<a name="l01795"></a>01795         snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/rx16"</span>, XBeeOsc_Name );
<a name="l01796"></a>01796         Osc_CreateMessage( channel, address, <span class="stringliteral">",iiib"</span>, srcAddr, sigStrength, opts, data, datalen );
<a name="l01797"></a>01797       }
<a name="l01798"></a>01798       <span class="keywordflow">break</span>;
<a name="l01799"></a>01799     }
<a name="l01800"></a>01800     <span class="keywordflow">case</span> <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d8416930034c81dfe130a62551a9272ba71" title="An incoming data packet with a 64-bit address.">XBEE_RX64</a>:
<a name="l01801"></a>01801     {
<a name="l01802"></a>01802       uint64 srcAddr;
<a name="l01803"></a>01803       uint8 sigStrength;
<a name="l01804"></a>01804       uint8 opts;
<a name="l01805"></a>01805       uint8* data;
<a name="l01806"></a>01806       uint8 datalen;
<a name="l01807"></a>01807       <span class="keywordflow">if</span>( <a class="code" href="group___x_bee.html#g366e1d12df63ac0bb6b4fbf380c9311c" title="Unpack the info from an incoming packet with a 64-bit address.">XBee_ReadRX64Packet</a>( xbp, &amp;srcAddr, &amp;sigStrength, &amp;opts, &amp;data, &amp;datalen ) )
<a name="l01808"></a>01808       {
<a name="l01809"></a>01809         snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/rx64"</span>, XBeeOsc_Name );
<a name="l01810"></a>01810         Osc_CreateMessage( channel, address, <span class="stringliteral">",iiib"</span>, srcAddr, sigStrength, opts, data, datalen );
<a name="l01811"></a>01811       }
<a name="l01812"></a>01812       <span class="keywordflow">break</span>;
<a name="l01813"></a>01813     }
<a name="l01814"></a>01814     <span class="keywordflow">case</span> <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d84ab62c1657ee730b996f8ae23316ab0f2" title="An incoming IO packet with a 16-bit address.">XBEE_IO16</a>:
<a name="l01815"></a>01815     {
<a name="l01816"></a>01816       <span class="keywordtype">int</span> in[9];
<a name="l01817"></a>01817       uint16 src;
<a name="l01818"></a>01818       uint8 sigstrength;
<a name="l01819"></a>01819       <span class="keywordflow">if</span>( <a class="code" href="group___x_bee.html#gdc33b8d4803250488422484b2129f659" title="Unpack the info from an incoming IO packet with a 16-bit address.">XBee_ReadIO16Packet</a>( xbp, &amp;src, &amp;sigstrength, NULL, in ) )
<a name="l01820"></a>01820       {
<a name="l01821"></a>01821         snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/io16"</span>, XBeeOsc_Name );
<a name="l01822"></a>01822         Osc_CreateMessage( channel, address, <span class="stringliteral">",iiiiiiiiiii"</span>, src, sigstrength, 
<a name="l01823"></a>01823                             in[0], in[1], in[2], in[3], in[4], in[5], in[6], in[7], in[8] );
<a name="l01824"></a>01824       }
<a name="l01825"></a>01825       <span class="keywordflow">break</span>;
<a name="l01826"></a>01826     }
<a name="l01827"></a>01827     <span class="keywordflow">case</span> <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d840cf36c28801085928d7c003a59343751" title="An incoming IO packet with a 64-bit address.">XBEE_IO64</a>:
<a name="l01828"></a>01828     {
<a name="l01829"></a>01829       <span class="keywordtype">int</span> in[9];
<a name="l01830"></a>01830       uint64 src;
<a name="l01831"></a>01831       uint8 sigstrength;
<a name="l01832"></a>01832       <span class="keywordflow">if</span>( <a class="code" href="group___x_bee.html#ga54eca4b48efbf8f8080203f9930c1cd" title="Unpack the info from an incoming IO packet with a 64-bit address.">XBee_ReadIO64Packet</a>( xbp, &amp;src, &amp;sigstrength, NULL, in ) )
<a name="l01833"></a>01833       {
<a name="l01834"></a>01834         snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/io64"</span>, XBeeOsc_Name );
<a name="l01835"></a>01835         Osc_CreateMessage( channel, address, <span class="stringliteral">",iiiiiiiiiii"</span>, src, sigstrength, 
<a name="l01836"></a>01836                             in[0], in[1], in[2], in[3], in[4], in[5], in[6], in[7], in[8] );
<a name="l01837"></a>01837       }
<a name="l01838"></a>01838       <span class="keywordflow">break</span>;
<a name="l01839"></a>01839     }
<a name="l01840"></a>01840     <span class="keywordflow">case</span> <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d84df5deb55382d3e65262cedabe6cedd3f" title="TX status packet.">XBEE_TXSTATUS</a>:
<a name="l01841"></a>01841     {
<a name="l01842"></a>01842       uint8 frameID;
<a name="l01843"></a>01843       uint8 status;
<a name="l01844"></a>01844       <span class="keywordflow">if</span>( <a class="code" href="group___x_bee.html#ga9d737273a7ae0ab7240424b058fc639" title="Unpack the info from TX Status packet.">XBee_ReadTXStatusPacket</a>( xbp, &amp;frameID, &amp;status ) )
<a name="l01845"></a>01845       {
<a name="l01846"></a>01846         snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/tx-status"</span>, XBeeOsc_Name );
<a name="l01847"></a>01847         <span class="keywordtype">char</span>* statusText = <span class="stringliteral">"No status received"</span>;
<a name="l01848"></a>01848         <span class="keywordflow">switch</span>( status )
<a name="l01849"></a>01849         {
<a name="l01850"></a>01850           <span class="keywordflow">case</span> 0:
<a name="l01851"></a>01851             statusText = <span class="stringliteral">"Success"</span>;
<a name="l01852"></a>01852             <span class="keywordflow">break</span>;
<a name="l01853"></a>01853           <span class="keywordflow">case</span> 1:
<a name="l01854"></a>01854             statusText = <span class="stringliteral">"No acknowledgement received"</span>;
<a name="l01855"></a>01855             <span class="keywordflow">break</span>;
<a name="l01856"></a>01856           <span class="keywordflow">case</span> 2:
<a name="l01857"></a>01857             statusText = <span class="stringliteral">"CCA Failure"</span>;
<a name="l01858"></a>01858             <span class="keywordflow">break</span>;
<a name="l01859"></a>01859           <span class="keywordflow">case</span> 3:
<a name="l01860"></a>01860             statusText = <span class="stringliteral">"Purged"</span>;
<a name="l01861"></a>01861             <span class="keywordflow">break</span>;
<a name="l01862"></a>01862         }
<a name="l01863"></a>01863         Osc_CreateMessage( channel, address, <span class="stringliteral">",is"</span>, frameID, statusText );
<a name="l01864"></a>01864       }
<a name="l01865"></a>01865       <span class="keywordflow">break</span>;
<a name="l01866"></a>01866     }
<a name="l01867"></a>01867     <span class="keywordflow">case</span> <a class="code" href="group___x_bee_packet_types.html#gg8ca462f963f0bfae1276106617f97d84cce6d88f7ded752cb874f687afa5f8a8" title="A response to an AT command query.">XBEE_ATCOMMANDRESPONSE</a>:
<a name="l01868"></a>01868     {
<a name="l01869"></a>01869       uint8 frameID;
<a name="l01870"></a>01870       <span class="keywordtype">char</span>* command;
<a name="l01871"></a>01871       uint8 status;
<a name="l01872"></a>01872       <span class="keywordtype">int</span> value;
<a name="l01873"></a>01873       <span class="keywordflow">if</span>( <a class="code" href="group___x_bee.html#gec56fbcf2e08aa68574da35e467b9ec6" title="Unpack the info from an incoming AT Command Response packet.">XBee_ReadAtResponsePacket</a>( xbp, &amp;frameID, &amp;command, &amp;status, &amp;value ) )
<a name="l01874"></a>01874       {
<a name="l01875"></a>01875         <span class="keywordtype">char</span> cmd[3];
<a name="l01876"></a>01876         cmd[0] = *command;
<a name="l01877"></a>01877         cmd[1] = *(command+1);
<a name="l01878"></a>01878         cmd[2] = <span class="charliteral">'\0'</span>;
<a name="l01879"></a>01879         <span class="keywordflow">if</span>( strcmp( cmd, <span class="stringliteral">"IR"</span> ) == 0 )
<a name="l01880"></a>01880         {
<a name="l01881"></a>01881           snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/samplerate"</span>, XBeeConfigOsc_Name );
<a name="l01882"></a>01882           Osc_CreateMessage( channel, address, <span class="stringliteral">",i"</span>, value );
<a name="l01883"></a>01883         }
<a name="l01884"></a>01884         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( cmd, <span class="stringliteral">"MY"</span> ) == 0 )
<a name="l01885"></a>01885         {
<a name="l01886"></a>01886           snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/address"</span>, XBeeConfigOsc_Name );
<a name="l01887"></a>01887           Osc_CreateMessage( channel, address, <span class="stringliteral">",i"</span>, value );
<a name="l01888"></a>01888         }
<a name="l01889"></a>01889         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( cmd, <span class="stringliteral">"CH"</span> ) == 0 )
<a name="l01890"></a>01890         {
<a name="l01891"></a>01891           snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/channel"</span>, XBeeConfigOsc_Name );
<a name="l01892"></a>01892           Osc_CreateMessage( channel, address, <span class="stringliteral">",i"</span>, value );
<a name="l01893"></a>01893         }
<a name="l01894"></a>01894         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( cmd, <span class="stringliteral">"ID"</span> ) == 0 )
<a name="l01895"></a>01895         {
<a name="l01896"></a>01896           snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/panid"</span>, XBeeConfigOsc_Name );
<a name="l01897"></a>01897           Osc_CreateMessage( channel, address, <span class="stringliteral">",i"</span>, value );
<a name="l01898"></a>01898         }
<a name="l01899"></a>01899         <span class="keywordflow">else</span>
<a name="l01900"></a>01900         {
<a name="l01901"></a>01901           snprintf( address, OSC_SCRATCH_SIZE, <span class="stringliteral">"/%s/at-command"</span>, XBeeConfigOsc_Name );
<a name="l01902"></a>01902           Osc_CreateMessage( channel, address, <span class="stringliteral">",si"</span>, cmd, value );
<a name="l01903"></a>01903         }
<a name="l01904"></a>01904       }
<a name="l01905"></a>01905       <span class="keywordflow">break</span>;
<a name="l01906"></a>01906     }
<a name="l01907"></a>01907   }
<a name="l01908"></a>01908   <a class="code" href="group___x_bee.html#g066e28d0aaafb23eb1171bcdb31e5c45" title="Initialize a packet before reading into it.">XBee_ResetPacket</a>( xbp );
<a name="l01909"></a>01909   <span class="keywordflow">return</span> retval;
<a name="l01910"></a>01910 }
<a name="l01911"></a>01911 
<a name="l01912"></a>01912 <span class="keywordtype">int</span> XBeeOsc_Async( <span class="keywordtype">int</span> channel )
<a name="l01913"></a>01913 {
<a name="l01914"></a>01914   <a class="code" href="group___x_bee.html#gf99a020a130eed99733b529b8cdb84a8" title="Controls the active state of the XBee subsystem.">XBee_SetActive</a>( 1 );
<a name="l01915"></a>01915   <span class="keywordtype">int</span> newMsgs = 0;
<a name="l01916"></a>01916 
<a name="l01917"></a>01917   <span class="keywordflow">if</span>( !XBee_GetAutoSend( <span class="keyword">false</span> ) || XBee-&gt;waitingForConfirm )
<a name="l01918"></a>01918     <span class="keywordflow">return</span> newMsgs;
<a name="l01919"></a>01919 
<a name="l01920"></a>01920   <span class="keywordflow">while</span>( <a class="code" href="group___x_bee.html#gb6f350a2b5dea977c3ab6244e4984833" title="Receive an incoming XBee packet.">XBee_GetPacket</a>( XBee-&gt;currentPkt, 0 ) )
<a name="l01921"></a>01921   {
<a name="l01922"></a>01922     XBeeOsc_HandleNewPacket( XBee-&gt;currentPkt, channel );
<a name="l01923"></a>01923     newMsgs++;
<a name="l01924"></a>01924   }
<a name="l01925"></a>01925   <span class="keywordflow">return</span> newMsgs;
<a name="l01926"></a>01926 }
<a name="l01927"></a>01927 
<a name="l01928"></a>01928 <span class="preprocessor">#endif // OSC</span>
<a name="l01929"></a>01929 <span class="preprocessor"></span>
<a name="l01930"></a>01930 
</pre></div></div>

<hr size="1">
<div>
  <p id="footer">The Make Controller Kit is an open source project maintained by <a href="http://www.makingthings.com">MakingThings</a>.<br />
    MakingThings code is released under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html" target="_blank">Apache 2.0 license</a>.<br />
    Bug tracker, development wiki and status can be found at <a href="http://dev.makingthings.com">http://dev.makingthings.com</a>.<br />
    This document was last updated on 18 May 2009.
  </p>
</div>
<!-- Google Analytics Code -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
_uacct = "UA-769030-1";
urchinTracker();
</script>
</body>
</html>
